<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>POS System Pro - Enterprise Solution</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #2563eb;
        --primary-dark: #1d4ed8;
        --primary-light: #eff6ff;
        --secondary: #10b981;
        --secondary-dark: #059669;
        --danger: #ef4444;
        --danger-dark: #dc2626;
        --warning: #f59e0b;
        --success: #10b981;
        --dark: #111827;
        --gray-900: #1f2937;
        --gray-800: #374151;
        --gray-700: #4b5563;
        --gray-600: #6b7280;
        --gray-500: #9ca3af;
        --gray-400: #d1d5db;
        --gray-300: #e5e7eb;
        --gray-200: #f3f4f6;
        --gray-100: #f9fafb;
        --white: #ffffff;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1),
          0 1px 2px 0 rgba(0, 0, 0, 0.06);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        --palette-purple: #7d3cff;
        --palette-green: #28a745;
        --palette-orange: #ff9500;
        --palette-red: #ff3b30;
        --palette-yellow: #f2c94c;
        --palette-blue: #007aff;
        --discounted-row: rgba(255, 0, 0, 0.15);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        background-color: var(--gray-100);
        color: var(--gray-900);
        line-height: 1.5;
        font-size: 14px;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* Scrollbar Styling */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--gray-100);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--gray-400);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--gray-500);
      }

      /* Layout */
      .app-container {
        display: flex;
        height: 100vh;
        overflow: hidden;
      }

      /* Sidebar now acts like a slide-in drawer on all screen sizes */
      .sidebar {
        position: fixed;
        left: -280px;               /* hidden off-canvas */
        top: 0;
        height: 100vh;
        width: 280px;
        background: var(--white);
        border-right: 1px solid var(--gray-200);
        display: flex;
        flex-direction: column;
        transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: var(--shadow-xl);
        z-index: 1000;
      }

      .sidebar.active {
        left: 0;                    /* slide into view */
      }

      .sidebar-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--gray-200);
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
      }

      .brand-logo {
        width: 40px;
        height: 40px;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
        font-weight: 700;
        box-shadow: var(--shadow-md);
      }

      .brand-name {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--gray-900);
        letter-spacing: -0.025em;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem;
        background: var(--gray-50);
        border-radius: 8px;
      }

      .user-avatar {
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
      }

      .user-details {
        flex: 1;
      }

      .user-name {
        font-weight: 600;
        color: var(--gray-900);
        font-size: 0.875rem;
      }

      .user-role {
        font-size: 0.75rem;
        color: var(--gray-600);
      }

      .nav-menu {
        flex: 1;
        padding: 1rem 0;
        overflow-y: auto;
      }

      .nav-item {
        display: flex;
        align-items: center;
        padding: 0.875rem 1.5rem;
        color: var(--gray-700);
        text-decoration: none;
        transition: var(--transition);
        position: relative;
        font-weight: 500;
        font-size: 0.875rem;
      }

      .nav-item:hover {
        color: var(--primary);
        background: var(--primary-light);
      }

      .nav-item.active {
        color: var(--primary);
        background: var(--primary-light);
      }

      .nav-item.active::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background: var(--primary);
      }

      .nav-item i {
        width: 20px;
        margin-right: 0.75rem;
        font-size: 1rem;
      }

      .nav-footer {
        padding: 1.5rem;
        border-top: 1px solid var(--gray-200);
      }

      .license-info {
        background: var(--gray-100);
        padding: 0.75rem;
        border-radius: 8px;
        text-align: center;
        margin-bottom: 0.5rem;
      }

      .license-badge {
        display: inline-block;
        background: var(--danger);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .app-version {
        text-align: center;
        font-size: 0.75rem;
        color: var(--gray-500);
      }

      /* Main Content */
      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        background: var(--gray-50);
      }

      /* Header */
      .header {
        background: var(--white);
        padding: 1rem 2rem;
        border-bottom: 1px solid var(--gray-200);
        display: flex;
        justify-content: space-between;
        align-items: center;
        min-height: 64px;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .mobile-menu-btn {
        display: block;
        background: transparent;
        border: none;
        color: var(--gray-700);
        font-size: 1.25rem;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 6px;
        transition: var(--transition);
      }

      .mobile-menu-btn:hover {
        background: var(--gray-100);
      }

      .page-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--gray-900);
        letter-spacing: -0.025em;
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .search-container {
        position: relative;
        width: 320px;
      }

      .search-input {
        width: 100%;
        padding: 0.625rem 1rem 0.625rem 2.75rem;
        border: 1px solid var(--gray-300);
        border-radius: 8px;
        font-size: 0.875rem;
        background: var(--gray-50);
        transition: var(--transition);
      }

      .search-input:focus {
        outline: none;
        border-color: var(--primary);
        background: var(--white);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-500);
      }

      .header-btn {
        background: transparent;
        border: 1px solid var(--gray-300);
        color: var(--gray-700);
        padding: 0.625rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .header-btn:hover {
        background: var(--gray-50);
        border-color: var(--gray-400);
      }

      .header-btn.primary {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }

      .header-btn.primary:hover {
        background: var(--primary-dark);
        border-color: var(--primary-dark);
      }

      /* Page Content */
      .page-content {
        flex: 1;
        padding: 0;
        overflow-y: auto;
      }

      /* Sale Page */
      .sale-layout {
        display: grid;
        grid-template-columns: 1fr 50px 420px;
        gap: 0.25rem;
        height: calc(100vh - 64px - 3rem);
      }

      .products-section {
        display: flex;
        flex-direction: column;
        gap: 0;
        overflow: hidden;
      }

      /* Categories */
      .categories-container {
        background: var(--white);
        border-radius: 12px;
        padding: 0.35rem;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--gray-200);
        overflow-x: auto;
      }

      .categories-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.35rem;
      }

      .categories-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--gray-900);
      }

      .categories-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 0.75rem;
        flex-wrap: unset; /* override previous flex */
        overflow-x: unset;
      }

      .category-card {
        padding: 0.5rem;
        flex: 1 1 auto; /* override fixed width */
        border: none;
        color: #fff;
      }
      .category-card:nth-child(1) {
        background: var(--palette-purple);
      }
      .category-card:nth-child(2) {
        background: var(--palette-green);
      }
      .category-card:nth-child(3) {
        background: var(--palette-orange);
      }
      .category-card:nth-child(4) {
        background: var(--palette-red);
      }
      .category-card:nth-child(5) {
        background: var(--palette-yellow);
        color: #000;
      }
      .category-card:nth-child(6) {
        background: var(--palette-blue);
      }
      .category-card:nth-child(7) {
        background: var(--palette-orange);
      }
      .category-card:nth-child(8) {
        background: var(--palette-red);
      }

      /* --- Neutralize category & product backgrounds --- */
      .category-card {
        background: var(--gray-50) !important;
        border: 1px solid var(--gray-200) !important;cursor:pointer;
        color: var(--gray-900) !important;
      }
      .product-card {
        background: var(--white) !important;
        border: 1px solid var(--gray-200) !important;
        color: var(--gray-900) !important;cursor:pointer
      }
      /* Remove specific nth-child color overrides */
      .category-card:nth-child(n),
      .product-card:nth-child(n) {
        background: inherit !important;
      }

      /* Products Grid */
      .products-container {
        background: var(--white);
        border-radius: 12px;
        padding: 0.35rem;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--gray-200);
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .products-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.35rem;
      }

      .products-actions {
        display: flex;
        gap: 0.5rem;
      }

      .view-toggle {
        display: flex;
        background: var(--gray-100);
        border-radius: 6px;
        padding: 0.25rem;
      }

      .view-btn {
        background: transparent;
        border: none;
        padding: 0.5rem 0.75rem;
        border-radius: 4px;
        cursor: pointer;
        color: var(--gray-600);
        transition: var(--transition);
      }

      .view-btn.active {
        background: var(--white);
        color: var(--primary);
        box-shadow: var(--shadow-sm);
      }

      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 0.5rem;
        overflow-y: auto;
        flex: 1;
      }

      .product-card {
        padding: 0.25rem;
        border: 1px solid var(--gray-200);
        border-radius: 6px;
        background: var(--white);
        display: flex;
        align-items: center;
        justify-content: center;
        height: 60px;
        font-size: 0.75rem;
        text-align: center;
        color: var(--gray-900);
      }
      .product-card:nth-child(odd) {
        background: var(--palette-purple);
      }
      .product-card:nth-child(even) {
        background: var(--palette-blue);
      }

      .product-image {
        width: 100%;
        height: 120px;
        background: var(--gray-100);
        border-radius: 8px;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        position: relative;
        overflow: hidden;
      }

      .product-badge {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background: var(--danger);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.625rem;
        font-weight: 600;
      }

      .product-info {
        text-align: left;
      }

      .product-name {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 0.5rem;
        display: -webkit-box;
        text-align: center;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .product-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .product-price {
        font-size: 1rem;
        font-weight: 700;
        color: var(--primary);
      }

      .product-stock {
        font-size: 0.75rem;
        color: var(--gray-500);
      }

      /* Cart Section */
      .cart-section {
        background: var(--white);
        border-radius: 12px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--gray-200);
        display: flex;
        flex-direction: column;
        height: 100%;
        position: relative;
      }

      .cart-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--gray-200);
      }

      .cart-title {
        font-size: 0; /* hide text */
      }
      .cart-title i,
      .cart-title .cart-badge {
        font-size: 1rem; /* restore icon & badge */
      }

      .cart-badge {
        background: var(--primary);
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .customer-section {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: var(--gray-50);
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
      }

      .select-wrapper {
        position: relative;
        
      }

      .select-input {
        width: 100%;
        padding: 0.75rem 2.5rem 0.75rem 1rem;
        border: 1px solid var(--gray-300);
        border-radius: 6px;
        font-size: 0.875rem;
        background: var(--white);
        cursor: pointer;
        appearance: none;
      }

      .select-icon {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-500);
        pointer-events: none;
      }

      .customer-actions {
        display: flex;
        gap: 0.25rem;
      }

      .customer-btn {
        flex: 1;
        padding: 0.5rem;
        border: 1px solid var(--gray-300);
        background: var(--white);
        border-radius: 6px;
        font-size: 0.75rem;
        color: var(--gray-700);
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.25rem;
      }

      .customer-btn:hover {
        border-color: var(--primary);
        color: var(--primary);
        background: var(--primary-light);
      }

      .discount-section {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .discount-label {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--gray-700);
      }

      .discount-input-group {
        display: flex;
        align-items: center;
        background: var(--white);
        border: 1px solid var(--gray-300);
        border-radius: 6px;
        overflow: hidden;
      }

      .disc-btn {
        width: 32px;
        height: 32px;
        border: none;
        background: var(--gray-100);
        color: var(--gray-600);
        font-size: 1rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
      }
      .disc-btn:hover {
        background: var(--gray-200);
        color: var(--primary);
      }

      .discount-input {
        width: 60px;
        padding: 0.5rem;
        border: none;
        text-align: center;
        font-size: 0.875rem;
      }

      .discount-input:focus {
        outline: none;
      }

      .discount-symbol {
        padding: 0.5rem;
        background: var(--gray-100);
        color: var(--gray-600);
        font-weight: 500;
      }

      /* Cart Items */
      .cart-items {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
      }

      .empty-cart {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: var(--gray-400);
      }

      .empty-cart-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
      }

      .empty-cart-text {
        font-size: 0.875rem;
        font-weight: 500;
      }

      .cart-item { 
        display:grid; 
        grid-template-columns:1fr 40px 60px 24px; 
        gap:0.5rem; 
        align-items:center; 
        padding:0.5rem 0.5rem; 
        border-bottom:1px solid var(--gray-200);
        border-radius:8px;
        background:var(--white);
        box-shadow:var(--shadow-sm);
        transition:var(--transition);
      } 
      .cart-item:not(.selected):hover{box-shadow:var(--shadow-md);} 
      .cart-item.selected{ background:var(--primary-light); border-color:var(--primary);} 
      .ci-name{ font-size:0.9rem; font-weight:600; color:var(--gray-900);} 
      .ci-qty,.ci-price{ font-size:0.9rem; color:var(--gray-700);} 
      .ci-disc{ font-size:0.85rem; color:var(--danger); } 
      .cart-item-remove{ background:none; border:none; color:var(--danger); cursor:pointer; font-size:0.8rem;} 

      /* Cart Footer */
      .cart-footer {
        border-top: 2px solid var(--gray-200);
        padding: 1.5rem;
        background: var(--gray-50);
        border-radius: 0 0 12px 12px;
      }

      .cart-summary {
        margin-bottom: 1rem;
      }

      .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
      }

      .summary-label {
        color: var(--gray-600);
      }

      .summary-value {
        font-weight: 600;
        color: var(--gray-900);
      }

      .summary-row.total {
        padding-top: 0.75rem;
        border-top: 1px solid var(--gray-300);
        font-size: 1.125rem;
      }

      .summary-row.total .summary-label {
        font-weight: 600;
        color: var(--gray-900);
      }

      .summary-row.total .summary-value {
        color: var(--primary);
        font-weight: 700;
      }

      .cart-actions {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 0.75rem;
      }

      /* Buttons */
      .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.875rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        position: relative;
        overflow: hidden;
      }

      .btn:active {
        transform: scale(0.98);
      }

      .btn-primary {
        background: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background: var(--primary-dark);
        box-shadow: var(--shadow-md);
      }

      .btn-secondary {
        background: var(--white);
        color: var(--gray-700);
        border: 1px solid var(--gray-300);
      }

      .btn-secondary:hover {
        background: var(--gray-50);
        border-color: var(--gray-400);
      }

      .btn-danger {
        background: var(--white);
        color: var(--danger);
        border: 1px solid var(--danger);
      }

      .btn-danger:hover {
        background: var(--danger);
        color: white;
      }

      .btn-success {
        background: var(--success);
        color: white;
      }

      .btn-success:hover {
        background: var(--secondary-dark);
      }

      .btn-icon {
        padding: 0.625rem;
        width: 40px;
        height: 40px;
      }

      /* Tables */
      .table-container {
        background: var(--white);
        border-radius: 12px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--gray-200);
        overflow: hidden;
      }

      .table-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--gray-200);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .table-title {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--gray-900);
      }

      .table-actions {
        display: flex;
        gap: 0.75rem;
      }

      .table-wrapper {
        overflow-x: auto;
      }

      .table {
        width: 100%;
        border-collapse: collapse;
      }

      .table th {
        background: var(--gray-50);
        padding: 0.75rem 1rem;
        text-align: left;
        font-weight: 600;
        font-size: 0.75rem;
        color: var(--gray-700);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        border-bottom: 1px solid var(--gray-200);
      }

      .table td {
        padding: 1rem;
        border-bottom: 1px solid var(--gray-100);
        font-size: 0.875rem;
        color: var(--gray-900);
      }

      .table tbody tr:hover {
        background: var(--gray-50);
      }

      /* Improved table striping */
      .table tbody tr:nth-child(even) {
        background: var(--gray-100);
      }
      .table tbody tr:hover {
        background: var(--gray-200);
      }

      /* Inline progress bar for percentage visuals */
      .progress-container {
        position: relative;
        width: 100%;
        height: 6px;
        background: var(--gray-300);
        border-radius: 3px;
        overflow: hidden;
      }
      .progress-fill {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        background: var(--primary);
        border-radius: 3px;
      }

      /* Badges */
      .badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
      }

      .badge-primary {
        background: var(--primary-light);
        color: var(--primary);
      }

      .badge-success {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
      }

      .badge-danger {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
      }

      .badge-warning {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning);
      }

      /* Stats Cards */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: var(--transition);
      }

      .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
        border-color: var(--primary);
      }

      .stat-icon-wrapper {
        width: 56px;
        height: 56px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
      }

      .stat-icon-wrapper.primary {
        background: var(--primary-light);
        color: var(--primary);
      }

      .stat-icon-wrapper.success {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
      }

      .stat-icon-wrapper.danger {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
      }

      .stat-icon-wrapper.warning {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning);
      }

      .stat-icon-wrapper.purple {
        background: rgba(139, 92, 246, 0.1);
        color: #8b5cf6;
      }

      .stat-details {
        flex: 1;
      }

      .stat-label {
        font-size: 0.875rem;
        color: var(--gray-600);
        margin-bottom: 0.25rem;
      }

      .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--gray-900);
        line-height: 1;
      }

      .stat-change {
        font-size: 0.75rem;
        margin-top: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }

      .stat-change.positive {
        color: var(--success);
      }

      .stat-change.negative {
        color: var(--danger);
      }

      /* Charts */
      .charts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 1.5rem;
      }

      .chart-container {
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: var(--shadow-sm);
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .chart-title {
        font-size: 1rem;
        font-weight: 700;
        color: var(--gray-900);
      }

      .chart-placeholder {
        height: 300px;
        background: var(--gray-50);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--gray-400);
        font-size: 0.875rem;
      }

      /* Forms */
      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--gray-700);
        margin-bottom: 0.5rem;
      }

      .form-input,
      .form-select,
      .form-textarea {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid var(--gray-300);
        border-radius: 8px;
        font-size: 0.875rem;
        background: var(--white);
        transition: var(--transition);
      }

      .form-input:focus,
      .form-select:focus,
      .form-textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      .form-textarea {
        resize: vertical;
        min-height: 100px;
      }

      .form-hint {
        font-size: 0.75rem;
        color: var(--gray-500);
        margin-top: 0.25rem;
      }

      /* Modals */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(4px);
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: var(--white);
        border-radius: 16px;
        padding: 2rem;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: var(--shadow-xl);
        animation: modalSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .modal-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--gray-900);
      }

      .modal-close {
        background: transparent;
        border: none;
        color: var(--gray-400);
        cursor: pointer;
        font-size: 1.25rem;
        padding: 0.25rem;
        transition: var(--transition);
      }

      .modal-close:hover {
        color: var(--gray-600);
      }

      .modal-footer {
        display: flex;
        gap: 0.75rem;
        justify-content: flex-end;
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--gray-200);
      }

      /* Loading */
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Responsive */
      @media (max-width: 1280px) {
        .sale-layout {
          grid-template-columns: 1fr 50px 380px;
        }
      }

      @media (max-width: 700px) {
        .sidebar {
          position: fixed;
          left: -280px;
          top: 0;
          height: 100vh;
          z-index: 1000;
          box-shadow: var(--shadow-xl);
        }

        .sidebar.active {
          left: 0;
        }

        .mobile-menu-btn {
          display: block;
        }

        .sale-layout {
          grid-template-columns: 1fr;
        }

        .cart-section {
          position: fixed;
          right: -420px;
          top: 0;
          width: 420px;
          height: 100vh;
          z-index: 999;
          transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          box-shadow: var(--shadow-xl);
          border-radius: 0;
        }

        .cart-section.active {
          right: 0;
        }

        .mobile-cart-toggle {
          position: fixed;
          bottom: 2rem;
          right: 2rem;
          width: 60px;
          height: 60px;
          background: var(--primary);
          color: white;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: var(--shadow-lg);
          cursor: pointer;
          z-index: 100;
        }

        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        .keypad-section {
          display: none;
        }
      }

      @media (max-width: 700px) {
        .header {
          padding: 1rem;
        }

        .search-container {
          width: 100%;
          order: 2;
          margin-top: 1rem;
        }

        .header-actions {
          width: 100%;
          flex-wrap: wrap;
        }

        .categories-grid {
          grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        }

        .products-grid {
          grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        }

        .cart-section {
          width: 100%;
          right: -100%;
        }

        .charts-grid {
          grid-template-columns: 1fr;
        }

        .purchase-row {
          grid-template-columns: 1fr 70px 50px 70px 50px auto;
        }
      }

      /* Print Styles */
      @media print {
        .sidebar,
        .header,
        .mobile-cart-toggle {
          display: none;
        }

        .main-content {
          margin: 0;
        }

        .page-content {
          padding: 0;
        }
      }

      /* Animations */
      .fade-in {
        animation: fadeIn 0.3s ease-in-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .slide-in {
        animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @keyframes slideIn {
        from {
          transform: translateX(20px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* Customer Modal Input Styles */
      .modal.customer-modal .form-input,
      .modal.customer-modal .form-select,
      .modal.customer-modal .form-textarea {
        background: var(--primary-light);
        border: none;
      }

      /* Settings Modal List Rows */
      .settings-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .settings-icon {
        color: var(--gray-500);
        font-size: 1rem;
        width: 20px;
        text-align: center;
      }

      .settings-label {
        flex: 1;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--gray-700);
      }

      /* Product Settings Modal */
      .modal#product-settings-modal .settings-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .modal#product-settings-modal .settings-icon {
        color: var(--gray-500);
        font-size: 1rem;
        width: 20px;
        text-align: center;
      }

      .modal#product-settings-modal .settings-label {
        flex: 1;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--gray-700);
      }

      /* Category Settings Modal */
      .modal#category-settings-modal .settings-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .modal#category-settings-modal .settings-icon {
        color: var(--gray-500);
        font-size: 1rem;
        width: 20px;
        text-align: center;
      }

      .modal#category-settings-modal .settings-label {
        flex: 1;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--gray-700);
      }

      .btn.btn-sm {
        padding: 0.25rem 0.75rem;
        font-size: 0.75rem;
      }

      /* Category Add/Edit Modal Input Styles */
      .modal.category-modal .form-input,
      .modal.category-modal .form-textarea,
      .modal.category-modal input[type="file"] {
        background: var(--primary-light);
        border: none;
      }

      /* Products list view */
      .products-grid.list-view {
        display: flex;
        flex-direction: column;
      }

      .products-grid.list-view .product-card {
        display: flex;
        align-items: center;
        padding: 0.75rem;
      }

      .products-grid.list-view .product-image {
        width: 60px;
        height: 60px;
        margin-bottom: 0;
        margin-right: 1rem;
        flex-shrink: 0;
      }

      .products-grid.list-view .product-info {
        flex: 1;
      }

      .products-grid.list-view .product-meta {
        justify-content: flex-end;
      }

      /* Toggle Button Group */
      .toggle-group {
        display: inline-flex;
        border: 1px solid var(--gray-300);
        border-radius: 6px;
        overflow: hidden;
      }

      .toggle-group .toggle-btn {
        padding: 0.5rem 1rem;
        background: var(--white);
        border: none;
        font-size: 0.75rem;
        cursor: pointer;
        color: var(--gray-700);
        transition: var(--transition);
      }

      .toggle-group .toggle-btn.active {
        background: var(--primary);
        color: white;
      }

      /* Daily Sales Summary Panel */
      .sales-summary {
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        padding: 1rem 1.25rem;
        max-width: 300px;
        background: var(--white);
        color: var(--danger);
        font-size: 0.9rem;
        line-height: 1.8;
        box-shadow: var(--shadow-sm);
      }

      .sales-summary .summary-row {
        display: flex;
        justify-content: space-between;
        white-space: nowrap;
      }

      .sales-summary .summary-label {
        font-weight: 600;
      }

      .sales-summary .summary-box {
        border: 1px solid var(--gray-300);
        border-radius: 8px;
        padding: 0.5rem;
        margin-top: 0.75rem;
        font-size: 0.75rem;
        color: var(--gray-700);
      }

      /* Invoice Modal Table */
      .invoice-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
      }

      .invoice-table th,
      .invoice-table td {
        padding: 0.5rem 0.25rem;
        font-size: 0.75rem;
        border-bottom: 1px solid var(--gray-300);
        text-align: left;
      }

      .invoice-table th {
        color: var(--gray-600);
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.7rem;
      }

      .invoice-total {
        text-align: right;
        font-weight: 700;
        margin-top: 1rem;
        color: var(--danger);
      }

      /* Shift Summary */
      .shift-summary {
        border: 1px solid var(--danger);
        border-radius: 12px;
        padding: 1rem 1.25rem;
        max-width: 380px;
        background: var(--white);
        color: var(--danger);
        font-size: 0.9rem;
        line-height: 1.8;
      }

      /* Shift Info Cards */
      .shift-info-card {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: var(--primary-light);
        border: 1px solid var(--primary);
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-size: 0.85rem;
        color: var(--primary);
        font-weight: 600;
        flex-wrap: wrap;
      }
      .shift-info-card .shift-number {
        color: var(--primary-dark);
      }
      .shift-info-card .shift-time {
        color: var(--gray-700);
        font-weight: 500;
      }
      .shift-summary .summary-row {
        display: flex;
        justify-content: space-between;
        white-space: nowrap;
      }
      .shift-summary .summary-label {
        font-weight: 600;
      }
      .shift-summary .cash-box {
        border: 1px solid var(--gray-300);
        border-radius: 8px;
        padding: 0.5rem;
        font-size: 0.75rem;
        color: var(--gray-700);
        margin-top: 0.5rem;
        text-align: center;
      }

      .shift-net {
        color: var(--danger);
        font-weight: 700;
        margin-left: 1rem;
        white-space: nowrap;
      }

      /* Download button */
      .btn-download {
        border: 1px solid var(--success);
        color: var(--success);
        background: var(--white);
      }
      .btn-download:hover {
        background: var(--success);
        color: white;
      }

      /* Product Settings specific */
      .modal#product-settings-modal .toggle-group {
        border: 1px solid var(--gray-300);
        border-radius: 20px;
        overflow: hidden;
      }
      .modal#product-settings-modal .toggle-group .toggle-btn {
        background: var(--gray-100);
        color: var(--gray-700);
        padding: 0.5rem 1.25rem;
        border: none;
        font-size: 0.75rem;
        cursor: pointer;
        flex: 1;
        transition: var(--transition);
      }
      .modal#product-settings-modal .toggle-group .toggle-btn.active {
        background: var(--primary);
        color: white;
      }
      .modal#product-settings-modal .settings-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        margin-bottom: 1rem;
      }
      .modal#product-settings-modal .settings-hint {
        font-size: 0.75rem;
        color: var(--gray-500);
        margin-left: 2.2rem;
      }
      .modal#product-settings-modal .btn-save-block {
        width: 100%;
      }

      /* -------- Purchases Modern Styles -------- */
      .purchase-totals {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
      }
      .purchase-total-label {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--danger);
      }
      .purchase-actions {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
      }
      .purchase-item {
        display: grid;
        grid-template-columns: 1fr 120px 80px 220px 80px 40px;
        align-items: center;
        gap: 0.75rem;
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: 12px;
        padding: 0.75rem 1rem;
        margin-bottom: 0.5rem;
        box-shadow: var(--shadow-sm);
      }
      .purchase-name {
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .old-details {
        font-weight: 400;
        color: var(--gray-600);
        margin-left: 0.25rem;
      }
      .icon-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.65rem;
        font-weight: 600;
        padding: 0.15rem 0.5rem;
        border-radius: 6px;
        margin-left: 0.5rem;
        cursor: pointer;
      }
      .icon-btn.history {
        color: var(--success);
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid var(--success);
      }
      .icon-btn.chart {
        color: var(--danger);
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid var(--danger);
      }
      .purchase-item .form-input {
        width: 100%;
      }
      @media (max-width: 768px) {
        .purchase-item {
          grid-template-columns: 1fr 90px 60px 150px 60px 40px;
        }
      }
      /* ----------------------------------------- */

      /* Field container with inline label */
      .purchase-field {
        display: flex;
        align-items: center;
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 10px;
        overflow: hidden;
        height: 40px;
      }
      .purchase-field input {
        flex: 1;
        border: none;
        background: transparent;
        padding: 0.5rem;
        text-align: center;
        font-size: 0.875rem;
      }
      .purchase-field .purchase-label {
        padding: 0 0.75rem;
        font-size: 0.75rem;
        color: var(--gray-600);
        background: var(--white);
        border-left: 1px solid var(--gray-300);
        white-space: nowrap;
      }

      .purchase-hint {
        grid-column: span 6;
        font-size: 0.75rem;
        color: var(--danger);
        margin-top: -4px;
      }

      /* Field group with label */
      .field-group {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      .field-label {
        font-size: 0.7rem;
        font-weight: 600;
        color: var(--gray-600);
        user-select: none;
      }

      /* Currency toggle */
      .currency-toggle {
        display: inline-flex;
        border: 1px solid var(--primary);
        border-radius: 6px;
        overflow: hidden;
        height: 40px;
        align-items: stretch;
      }
      .currency-toggle .toggle-btn {
        display: flex;
        align-items: center;
        padding: 0.25rem 0.6rem;
        font-size: 0.7rem;
        border: none;
        background: transparent;
        color: var(--primary);
        cursor: pointer;
        transition: var(--transition);
        height: 100%;
      }
      .currency-toggle .toggle-btn.active {
        background: var(--primary);
        color: #fff;
      }

      /* --- Sidebar toggle enhancements --- */
      @media (min-width: 1025px) {
        .sidebar.collapsed {
          display: none;
        }
      }

      /* Center category text and ensure icons hidden */
      .category-card {
        display: flex !important;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      .category-name {
        text-align: center !important;
      }

      /* ---------------- CUSTOM POS MODIFICATIONS ---------------- */
      /* Product card sizing */
      .product-card {
        font-size: 0.75rem;
      }
      .product-image {
        height: 60px !important;
        font-size: 2rem !important;
        display: flex !important; /* restore visibility when not hidden */
      }
      /* Hide images when toggle off */
      .products-grid.hide-images .product-image {
        display: none !important;
      }
      /* ------------------------------------------------------------ */
      /* Ensure cards shrink when images hidden */
      .products-grid.hide-images .product-card {
        height: 70px !important; /* compressed height roughly similar to category cards */
        width: 100%;
      }
      /* Compact style for product cards when images hidden */
      .products-grid.hide-images .product-card {
        padding: 0.4rem 0.3rem !important;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0.15rem;
      }
      .products-grid.hide-images .product-name {
        font-size: 0.75rem !important;
        line-height: 1.1;
        -webkit-line-clamp: 2;
      }
      .products-grid.hide-images .product-meta {
        display: none !important; /* hide price+stock row to reduce height */
      }

      /* ----- Header extra elements (order-type & exchange rate) ----- */
      .order-type-toggle {
        margin-left: 1rem;
      }
      .exchange-rate {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--secondary);
        margin-left: 1rem;
        white-space: nowrap;
      }

      /* Toolbar just below the Products header */
      .products-toolbar {
        display: none;
      }

      /* ---------- KEYPAD STYLES ---------- */
      .keypad-section {
        width: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .keypad-grid {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
        width: 100%;
      }
      .key-btn {
        padding: 0;
        width: 100%;
        aspect-ratio: 1/1; /* square */
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--white);
        border: 1px solid var(--gray-300);
        border-radius: 8px;
        font-size: 0.875rem; /* slightly smaller text */
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
      }
      .key-btn:hover {
        background: var(--primary-light);
      }
      .cart-item.selected {
        border-color: var(--primary);
        box-shadow: var(--shadow-md);
      }
      @media (max-width: 700px) {
        .keypad-section {
          display: none;
        }
      }
      /* ---------- KEYPAD STYLES ---------- */
      .top-row {
        display: flex;
        gap: 0;
        align-items: flex-start;
      }
      .top-row .categories-container {
        flex: 1;
      }

      /***** Add or update CSS rule *****/
      .discounted-row {
        background-color: #ffe5e5 !important; /* lighter red */
        border-left: 4px solid #b91c1c !important; /* darker red border */
      }
      .invoice-discount {
        color: var(--danger);
        font-weight: 700;
      }

      /* Report totals styling */
      .stat-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.9rem;
        margin-bottom: 0.35rem;
        font-weight: 600;
      }
      .stat-label {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .stat-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
      }
      .dot-revenue {
        background: var(--warning);
      }
      .dot-cost {
        background: var(--primary);
      }
      .dot-profit {
        background: var(--success);
      }
      .dot-exp {
        background: var(--danger);
      }
      .stat-value {
        white-space: nowrap;
        color: var(--gray-800);
      }

      /* ---- Dashboard Modern Styles ---- */
      .period-toggle {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 1.5rem;
      }
      .period-btn {
        padding: 0.5rem 1.25rem;
        font-size: 0.75rem;
        border-radius: 9999px;
        border: 1px solid var(--gray-300);
        background: var(--white);
        cursor: pointer;
        transition: var(--transition);
      }
      .period-btn.active {
        background: var(--primary);
        border-color: var(--primary);
        color: #fff;
      }

      .quick-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }
      .quick-stat-card {
        border-radius: 12px;
        padding: 1rem 1.25rem;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
        box-shadow: var(--shadow-sm);
        background: var(--white);
      }
      .quick-stat-value {
        font-size: 1.75rem;
        font-weight: 700;
      }
      .quick-stat-label {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--gray-600);
      }
      .quick-stat-card.products {
        background: var(--primary-light);
        color: var(--primary);
      }
      .quick-stat-card.receipts {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
      }
      .quick-stat-card.customers {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
      }
      .quick-stat-card.users {
        background: rgba(59, 130, 246, 0.1);
        color: var(--primary);
      }
      .quick-stat-card.warnings {
        background: rgba(245, 158, 11, 0.15);
        color: var(--warning);
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
        gap: 1.5rem;
      }
      /* ---- End Dashboard Modern Styles ---- */

      /* ---------- Product Card Hover & Quick Action Styles ---------- */
      .product-card {
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }
      .product-card:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: var(--shadow-md);
      }
      /* Quick Action Modal */
      .modal#product-action-modal .quick-action-btn {
        width: 100%;
      }
      .modal#product-action-modal .modal-content {
        max-width: 300px;
      }
      /* ---------- End Custom Styles ---------- */

      /* Category card hover same effect */
      .category-card {
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }
      .category-card:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: var(--shadow-md);
      }

      /* --------- New Responsive Rule for Floating Cart Button --------- */
      /* Hide by default */
      .mobile-cart-toggle {
        display: none;
      }

      /* Keep hidden from 701px up to 1024px (overrides the earlier 1024px rule) */
      @media (min-width: 701px) {
        .mobile-cart-toggle {
          display: none !important;
        }
      }

      /* Show when the viewport is 700px or below */
      @media (max-width: 700px) {
        .mobile-cart-toggle {
          position: fixed;
          bottom: 2rem;
          right: 2rem;
          width: 60px;
          height: 60px;
          background: var(--primary);
          color: #ffffff;
          border-radius: 50%;
          display: flex !important;
          align-items: center;
          justify-content: center;
          box-shadow: var(--shadow-lg);
          cursor: pointer;
          z-index: 100;
        }
      }

      /* ---------- Override Product Card Details ---------- */
      .product-card .product-image,
      .product-card .product-meta,
      .product-card .product-price,
      .product-card .product-stock {
        display: none !important;
      }
     
      /* ------------------------------------ */
      /* Category & Product Color Mapping */
      /* ------------------------------------ */

      /* Category cards */
      .categories-grid .category-card:nth-child(1) { background: var(--palette-purple) !important; color:#fff !important; }
      .categories-grid .category-card:nth-child(2) { background: var(--palette-green) !important; color:#fff !important; }
      .categories-grid .category-card:nth-child(3) { background: var(--palette-orange) !important; color:#fff !important; }
      .categories-grid .category-card:nth-child(4) { background: var(--palette-red) !important; color:#fff !important; }
      .categories-grid .category-card:nth-child(5) { background: var(--palette-yellow) !important; color:#000 !important; }
      .categories-grid .category-card:nth-child(6) { background: var(--palette-blue) !important; color:#fff !important; }
      .categories-grid .category-card:nth-child(7) { background: var(--palette-orange) !important; color:#fff !important; }
      .categories-grid .category-card:nth-child(8) { background: var(--palette-red) !important; color:#fff !important; }

      /* Product cards repeating same palette order every 6 */
      .products-grid .product-card:nth-child(6n+1) { background: var(--palette-purple) !important; color:#fff !important; }
      .products-grid .product-card:nth-child(6n+2) { background: var(--palette-green) !important; color:#fff !important; }
      .products-grid .product-card:nth-child(6n+3) { background: var(--palette-orange) !important; color:#fff !important; }
      .products-grid .product-card:nth-child(6n+4) { background: var(--palette-red) !important; color:#fff !important; }
      .products-grid .product-card:nth-child(6n+5) { background: var(--palette-yellow) !important; color:#000 !important; }
      .products-grid .product-card:nth-child(6n+6) { background: var(--palette-blue) !important; color:#fff !important; }

      /* Center product name */
      .product-card {
        text-align:center;
      }

      /* Cart header tweaks */
      .cart-title {
        font-size: 0; /* hide text */
      }
      .cart-title i,
      .cart-title .cart-badge {
        font-size: 1rem; /* restore icon & badge */
      }

      /* Customer section inline buttons */
      .customer-section {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .customer-actions {
        display: flex;
        gap: 0.25rem;
      }

      /* Hide subtotal, discount, tax rows */
      .cart-summary .summary-row:nth-child(-n+3) { /* first three rows */
        display: none;
      }

      /* Simplify cart-item visuals */
      .cart-item-header .cart-item-remove { display: none; }
      .cart-item-details {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .cart-item-details .quantity-controls { display: none; }

      /* extra cart/UI tweaks */
      .customer-btn { height: 38px; padding:0 0.5rem; }
      .cart-items { max-height: 300px; overflow-y:auto; }
      /* -------- Cart minimalist style -------- */
      .cart-items { max-height: 300px; overflow-y:auto; }
      .cart-item { display:grid; grid-template-columns:1fr 40px 60px 24px; gap:0.5rem; align-items:center; padding:0.5rem 0.5rem; border-bottom:1px solid var(--gray-200);} 
      .cart-item.selected { background: var(--primary-light); }
      .ci-name{ font-size:0.9rem; }
      .ci-qty{ text-align:center; font-size:0.9rem; }
      .ci-price{ text-align:right; font-size:0.9rem; }
      .ci-disc{ font-size:0.85rem; color:var(--danger); }
      .cart-item-remove{ background:none; border:none; color:var(--danger); cursor:pointer; font-size:0.8rem;} 

      /* Cart title layout */
      .cart-title{display:flex;align-items:center;gap:0.5rem;font-size:0;}
      .cart-title i,.cart-title .cart-badge{font-size:1rem;}
      .order-type-toggle{margin-left:auto;font-size:0.75rem;}
      /* New header row style */
      .cart-header-row{ display:grid; grid-template-columns:1fr 40px 60px 24px; gap:0.5rem; align-items:center; padding:0.5rem 0.5rem; font-weight:600; font-size:0.85rem; border-bottom:1px solid var(--gray-300); background:var(--gray-50);} 

      /* Hide Open Drawer button */
      .cart-actions button[onclick*="openDrawer"]{display:none;}
      .cart-actions{grid-template-columns:1fr;}
      /* Payment Modal */
      .pay-modal-content{max-width:420px;width:90%;}
      .payment-info{margin:0.75rem 0;font-size:1rem;color:var(--gray-700);} 
      .pay-total{font-weight:600;}
      .pay-return{color:var(--danger);font-weight:700;font-size:1.125rem;margin-top:0.5rem;}
      .pay-keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin:1rem 0;}
      .pay-keypad button{padding:0.9rem 0;font-size:1rem;background:var(--gray-100);border:1px solid var(--gray-300);border-radius:6px;cursor:pointer;}
      .pay-keypad button:active{background:var(--gray-200);}
      /* New positioning: move dine-in / delivery toggle to far right of cart */
      .cart-header{
        position:relative; /* allow absolute positioning of toggle */
      }
      .cart-header .order-type-toggle{
        position:absolute;
        right:1.5rem; /* align with padding of cart-header */
        top:1.5rem;  /* align vertically with header padding */
        margin-left:0 !important; /* override previous auto margin */
      }
      /* Responsive tweak for small screens (stacked cart layout) */
      @media (max-width:700px){
        .cart-header .order-type-toggle{
          right:1rem;
          top:1rem;
        }
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script>
      // Fallback for Chart.js CDN failure
      window.addEventListener("load", function () {
        if (typeof Chart === "undefined") {
          console.warn("Primary Chart.js CDN failed, trying fallback...");
          var script = document.createElement("script");
          script.src =
            "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js";
          script.onload = function () {
            console.log("Fallback Chart.js loaded successfully");
            if (
              typeof initializeDashboardCharts !== "undefined" &&
              document.getElementById("topProductsChart")
            ) {
              initializeDashboardCharts();
            }
          };
          script.onerror = function () {
            console.error("Both Chart.js CDNs failed to load");
          };
          document.head.appendChild(script);
        }
      });
    </script>
  </head>
  <body>
    <div class="app-container">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="brand">
            <img
              src="./images/logo.png"
              style="width: 200px; height: 140px; object-fit: cover"
            />
          </div>
          <div class="user-info">
            <div class="user-details">
              <div class="user-name">Meat & Cheese</div>
              <div class="user-role">Superadmin</div>
            </div>
          </div>
        </div>

        <nav class="nav-menu">
          <a
            href="#sale"
            class="nav-item active"
            onclick="event.preventDefault(); showPage('sale')"
          >
            <i class="fas fa-cash-register"></i>
            <span>Point of Sale</span>
          </a>
          <a
            href="#daily-sales"
            class="nav-item"
            onclick="event.preventDefault(); showPage('daily-sales')"
          >
            <i class="fas fa-chart-line"></i>
            <span>Daily Sales</span>
          </a>
          <a
            href="#shift"
            class="nav-item"
            onclick="event.preventDefault(); showPage('shift')"
          >
            <i class="fas fa-clock"></i>
            <span>Shift Management</span>
          </a>
          <a
            href="#inventory"
            class="nav-item"
            onclick="event.preventDefault(); showPage('inventory')"
          >
            <i class="fas fa-warehouse"></i>
            <span>Inventory</span>
          </a>
          <a
            href="#purchases"
            class="nav-item"
            onclick="event.preventDefault(); showPage('purchases')"
          >
            <i class="fas fa-shopping-cart"></i>
            <span>Purchases</span>
          </a>
          <a
            href="#customers"
            class="nav-item"
            onclick="event.preventDefault(); showPage('customers')"
          >
            <i class="fas fa-users"></i>
            <span>Customers</span>
          </a>
          <a
            href="#users"
            class="nav-item"
            onclick="event.preventDefault(); showPage('users')"
          >
            <i class="fas fa-user-cog"></i>
            <span>User Management</span>
          </a>
          <a
            href="#settings"
            class="nav-item"
            onclick="event.preventDefault(); showPage('settings')"
          >
            <i class="fas fa-cog"></i>
            <span>Settings</span>
          </a>
          <a
            href="#reports"
            class="nav-item"
            onclick="event.preventDefault(); showPage('reports')"
          >
            <i class="fas fa-file-alt"></i>
            <span>Reports</span>
          </a>
          <a
            href="#dashboard"
            class="nav-item"
            onclick="event.preventDefault(); showPage('dashboard')"
          >
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </a>
        </nav>

        <div class="nav-footer">
          <div class="license-info">
            <div class="license-badge">3 Days Left</div>
          </div>
          <div class="app-version">Version 1.7.2   2025 Company</div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Header -->
        <header class="header">
          <div class="header-left">
            <button class="mobile-menu-btn" onclick="toggleSidebar()">
              <i class="fas fa-bars"></i>
            </button>
            <h1 class="page-title" id="page-title">Point of Sale</h1>
          </div>
          <div class="header-actions">
            <div class="search-container">
              <i class="fas fa-search search-icon"></i>
              <input
                type="text"
                class="search-input"
                placeholder="Search by barcode or name..."
              />
            </div>
            <!-- Exchange Rate Display -->
            <div class="exchange-rate" id="exchange-rate-display">
              1 USD => 90,000 LBP
            </div>
            <button class="header-btn">
              <i class="fas fa-bell"></i>
            </button>
            <button
              class="header-btn"
              onclick="openModal('product-settings-modal')"
            >
              <i class="fas fa-cog"></i>
            </button>
          </div>
        </header>

        <!-- Page Content -->
        <div class="page-content" id="page-content">
          <!-- Content will be dynamically loaded here -->
        </div>
      </main>
    </div>

    <!-- Mobile Cart Toggle (for Sale page) -->
    <div
      class="mobile-cart-toggle"
      id="mobile-cart-toggle"
      /* initially hidden; CSS handles visibility */
      onclick="toggleCart()"
    >
      <i class="fas fa-shopping-cart"></i>
    </div>

    <!-- Add Customer Modal -->
    <div class="modal customer-modal" id="add-customer-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Add New Customer</h2>
          <button
            class="modal-close"
            onclick="closeModal('add-customer-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form>
          <div class="form-group">
            <label class="form-label">Customer Name</label>
            <input
              type="text"
              class="form-input"
              placeholder="Enter customer name"
            />
          </div>
          <div class="form-group">
            <label class="form-label">Phone Number</label>
            <input
              type="tel"
              class="form-input"
              placeholder="Enter phone number"
            />
          </div>
          <div class="form-group">
            <label class="form-label">Email Address</label>
            <input
              type="email"
              class="form-input"
              placeholder="Enter email (optional)"
            />
          </div>
          <div class="form-group">
            <label class="form-label">Address</label>
            <textarea
              class="form-textarea"
              placeholder="Enter address"
            ></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Discount (%)</label>
            <input
              type="number"
              class="form-input"
              placeholder="0"
              min="0"
              max="100"
            />
            <div class="form-hint">Customer-specific discount percentage</div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal('add-customer-modal')"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-plus"></i>
              Add Customer
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Customer Modal -->
    <div class="modal customer-modal" id="edit-customer-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Edit Customer</h2>
          <button
            class="modal-close"
            onclick="closeModal('edit-customer-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form>
          <div class="form-group">
            <label class="form-label">Customer Name</label>
            <input
              type="text"
              class="form-input"
              placeholder="Enter customer name"
            />
          </div>
          <div class="form-group">
            <label class="form-label">Phone Number</label>
            <input
              type="tel"
              class="form-input"
              placeholder="Enter phone number"
            />
          </div>
          <div class="form-group">
            <label class="form-label">Email Address</label>
            <input type="email" class="form-input" placeholder="Enter email" />
          </div>
          <div class="form-group">
            <label class="form-label">Address</label>
            <textarea
              class="form-textarea"
              placeholder="Enter address"
            ></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Discount (%)</label>
            <input
              type="number"
              class="form-input"
              placeholder="0"
              min="0"
              max="100"
            />
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal('edit-customer-modal')"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i>
              Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Product Settings Modal -->
    <div class="modal" id="product-settings-modal">
      <div class="modal-content" style="max-width: 640px">
        <div class="modal-header">
          <h2 class="modal-title">Product Settings</h2>
          <button
            class="modal-close"
            onclick="closeModal('product-settings-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <!-- SETTINGS LIST -->
        <div class="settings-item">
          <i class="fas fa-bold settings-icon"></i>
          <span class="settings-label">Font Weight Bold ?</span>
          <div class="toggle-group">
            <button
              type="button"
              class="toggle-btn"
              onclick="switchToggle(this)"
            >
              On
            </button>
            <button
              type="button"
              class="toggle-btn active"
              onclick="switchToggle(this)"
            >
              Off
            </button>
          </div>
        </div>
        <div class="settings-item">
          <i class="fas fa-shopping-basket settings-icon"></i>
          <span class="settings-label">Show Qty ?</span>
          <div class="toggle-group">
            <button
              type="button"
              class="toggle-btn"
              onclick="switchToggle(this)"
            >
              On
            </button>
            <button
              type="button"
              class="toggle-btn active"
              onclick="switchToggle(this)"
            >
              Off
            </button>
          </div>
        </div>
        <div class="settings-item">
          <i class="fas fa-arrows-alt-h settings-icon"></i>
          <span class="settings-label">Product width</span>
          <button class="btn btn-secondary">
            90.0 <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        <div
          class="settings-item"
          style="flex-direction: column; align-items: flex-start; gap: 0.25rem"
        >
          <div
            style="display: flex; align-items: center; gap: 1rem; width: 100%"
          >
            <i class="fas fa-eye settings-icon"></i>
            <span class="settings-label">Hide or Show text</span>
            <div style="margin-left: auto" class="toggle-group">
              <button
                type="button"
                class="toggle-btn"
                onclick="switchToggle(this)"
              >
                Hide
              </button>
              <button
                type="button"
                class="toggle-btn active"
                onclick="switchToggle(this)"
              >
                Show
              </button>
            </div>
          </div>
          <span class="settings-hint"
            >Press 'Hide' to hide or 'Show' to show text for products with
            images</span
          >
        </div>
        <div class="settings-item">
          <i class="fas fa-percentage settings-icon"></i>
          <span class="settings-label">default profit rate %</span>
          <button class="btn btn-secondary">
            0.0 <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        <div class="settings-item">
          <i class="fas fa-eye settings-icon"></i>
          <span class="settings-label">show Min selling Price</span>
          <div class="toggle-group">
            <button
              type="button"
              class="toggle-btn"
              onclick="switchToggle(this)"
            >
              On
            </button>
            <button
              type="button"
              class="toggle-btn active"
              onclick="switchToggle(this)"
            >
              Off
            </button>
          </div>
        </div>
        <div class="settings-item">
          <i class="fas fa-eye settings-icon"></i>
          <span class="settings-label">show Weighted product</span>
          <div class="toggle-group">
            <button
              type="button"
              class="toggle-btn"
              onclick="switchToggle(this)"
            >
              On
            </button>
            <button
              type="button"
              class="toggle-btn active"
              onclick="switchToggle(this)"
            >
              Off
            </button>
          </div>
        </div>
        <div
          class="settings-item"
          style="flex-direction: column; align-items: flex-start; gap: 0.25rem"
        >
          <div
            style="display: flex; align-items: center; gap: 1rem; width: 100%"
          >
            <i class="fas fa-copy settings-icon"></i>
            <span class="settings-label"
              >Quick Add: Duplicate Latest Added Product</span
            >
            <div style="margin-left: auto" class="toggle-group">
              <button
                type="button"
                class="toggle-btn"
                onclick="switchToggle(this)"
              >
                On
              </button>
              <button
                type="button"
                class="toggle-btn active"
                onclick="switchToggle(this)"
              >
                Off
              </button>
            </div>
          </div>
          <span class="settings-hint"
            >When adding a new product, the form pre-fills with the details of
            the latest added product, allowing quick edits and adjustments</span
          >
        </div>
        <div
          class="modal-footer"
          style="border-top: none; justify-content: center"
        >
          <button
            type="button"
            class="btn btn-secondary btn-save-block"
            onclick="closeModal('product-settings-modal')"
          >
            <i class="fas fa-save"></i> save
          </button>
        </div>
      </div>
    </div>

    <!-- Category Settings Modal -->
    <div class="modal" id="category-settings-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Categories Settings</h2>
          <button
            class="modal-close"
            onclick="closeModal('category-settings-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="settings-item">
          <i class="fas fa-arrows-alt-h settings-icon"></i>
          <span class="settings-label">Category Width</span>
          <button class="btn btn-secondary">
            100.0 <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        <div class="settings-item">
          <i class="fas fa-bars settings-icon"></i>
          <span class="settings-label">Number of Lines</span>
          <button class="btn btn-secondary">
            2 <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        <div class="settings-item">
          <i class="fas fa-sort settings-icon"></i>
          <span class="settings-label">Change Category Order</span>
          <button class="btn btn-secondary">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            onclick="closeModal('category-settings-modal')"
          >
            Cancel
          </button>
          <button type="button" class="btn btn-primary">
            <i class="fas fa-save"></i> Save
          </button>
        </div>
      </div>
    </div>

    <!-- Add Category Modal -->
    <div class="modal category-modal" id="add-category-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Add Category</h2>
          <button
            class="modal-close"
            onclick="closeModal('add-category-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form>
          <div class="form-group">
            <label class="form-label">Category Title</label>
            <input
              type="text"
              class="form-input"
              placeholder="Enter category title"
              required
            />
          </div>
          <div class="form-group">
            <label class="form-label">Image / Icon</label>
            <input type="file" accept="image/*" required />
            <div class="form-hint">Recommended size: 128128px (PNG / JPG)</div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal('add-category-modal')"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-plus"></i> Add Category
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add Transaction Modal -->
    <div class="modal" id="add-transaction-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Add Transaction</h2>
          <button
            class="modal-close"
            onclick="closeModal('add-transaction-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form
          onsubmit="event.preventDefault(); /* TODO: save transaction */ closeModal('add-transaction-modal');"
        >
          <div class="form-group" style="text-align: center">
            <div class="toggle-group">
              <button
                type="button"
                class="toggle-btn active"
                onclick="switchToggle(this)"
              >
                Deposit
              </button>
              <button
                type="button"
                class="toggle-btn"
                onclick="switchToggle(this)"
              >
                Withdraw
              </button>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Amount</label>
            <input
              type="number"
              class="form-input"
              placeholder="Amount"
              required
              min="0"
              step="0.01"
            />
          </div>
          <div class="form-group" style="text-align: center">
            <div class="toggle-group">
              <button
                type="button"
                class="toggle-btn active"
                onclick="switchToggle(this)"
              >
                USD
              </button>
              <button
                type="button"
                class="toggle-btn"
                onclick="switchToggle(this)"
              >
                LBP
              </button>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal('add-transaction-modal')"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">Add</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Invoice Details Modal -->
    <div class="modal" id="invoice-modal">
      <div class="modal-content" style="max-width: 600px">
        <div class="modal-header">
          <h2 class="modal-title" id="invoice-title">Invoice</h2>
          <button class="modal-close" onclick="closeModal('invoice-modal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div id="invoice-body">
          <!-- dynamic table here -->
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            onclick="closeModal('invoice-modal')"
          >
            Cancel
          </button>
          <button type="button" class="btn btn-secondary">
            <i class="fas fa-print"></i> Print Receipt
          </button>
          <button
            type="button"
            id="invoice-download-btn"
            class="btn btn-danger"
            style="display: none"
          >
            <i class="fas fa-download"></i> Download
          </button>
        </div>
      </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal" id="add-product-modal">
      <div class="modal-content" style="max-width: 800px; width: 90%">
        <div class="modal-header">
          <h2 class="modal-title">Add Product</h2>
          <button class="modal-close" onclick="closeModal('add-product-modal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form
          onsubmit="event.preventDefault(); /* TODO: Save product */ closeModal('add-product-modal');"
        >
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
              gap: 1rem;
            "
          >
            <div class="form-group">
              <label class="form-label">Category</label>
              <select class="form-select">
                <option>Sandwiches</option>
                <option>Burger</option>
                <option>Drinks</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Discount (%)</label>
              <input
                type="number"
                class="form-input"
                placeholder="0"
                min="0"
                max="100"
                step="0.1"
              />
            </div>
            <div class="form-group" style="grid-column: span 2">
              <label class="form-label">Name</label>
              <input
                type="text"
                class="form-input"
                placeholder="Product name"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Barcode</label>
              <input type="text" class="form-input" placeholder="Barcode" />
            </div>
            <div class="form-group">
              <label class="form-label">Cost Price</label>
              <input
                type="number"
                class="form-input"
                placeholder="0.00"
                min="0"
                step="0.01"
              />
            </div>
            <div class="form-group">
              <label class="form-label">Profit rate (%)</label>
              <input
                type="number"
                class="form-input"
                placeholder="0"
                min="0"
                step="0.1"
              />
            </div>
            <div class="form-group">
              <label class="form-label">Selling Price (USD)</label>
              <input
                type="number"
                class="form-input"
                placeholder="0.00"
                min="0"
                step="0.01"
              />
            </div>
            <div class="form-group">
              <label class="form-label">Selling Price (LBP)</label>
              <input
                type="number"
                class="form-input"
                placeholder="0"
                min="0"
                step="1"
              />
            </div>
            <div class="form-group">
              <label class="form-label">Qty</label>
              <input type="number" class="form-input" placeholder="0" min="0" />
            </div>
            <div class="form-group">
              <label class="form-label">Warning Alert</label>
              <input type="number" class="form-input" placeholder="1" min="0" />
            </div>
            <div class="form-group">
              <label class="form-label">Expiry Date</label>
              <input type="date" class="form-input" />
            </div>
            <div
              class="form-group"
              style="display: flex; align-items: center; gap: 0.5rem"
            >
              <input type="checkbox" id="tracked-checkbox" />
              <label for="tracked-checkbox" class="form-label" style="margin: 0"
                >Tracked</label
              >
            </div>
            <div
              class="form-group"
              style="grid-column: span 2; text-align: center"
            >
              <label class="form-label">Product Image</label>
              <input
                type="file"
                accept="image/*"
                style="display: none"
                id="product-image-input"
              />
              <label
                for="product-image-input"
                style="
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                  justify-content: center;
                  border: 2px dashed var(--gray-300);
                  border-radius: 8px;
                  padding: 2rem;
                  cursor: pointer;
                  color: var(--gray-500);
                "
              >
                <i
                  class="fas fa-cloud-upload-alt"
                  style="font-size: 2rem; margin-bottom: 0.5rem"
                ></i>
                <span>Click to upload</span>
              </label>
            </div>
            <!-- Notifications toggle -->
            <div
              class="form-group"
              style="
                display: flex;
                align-items: center;
                gap: 0.75rem;
                margin-bottom: 1rem;
              "
            >
              <label class="form-label" style="margin: 0"
                >Enable/Disable Notifications</label
              >
              <div class="toggle-group">
                <button
                  type="button"
                  class="toggle-btn active"
                  onclick="switchToggle(this)"
                >
                  On
                </button>
                <button
                  type="button"
                  class="toggle-btn"
                  onclick="switchToggle(this)"
                >
                  Off
                </button>
              </div>
            </div>
          </div>
          <!-- closing the big grid div -->
          <!-- Select from stock row -->
          <div
            class="form-group"
            style="
              display: flex;
              align-items: center;
              gap: 0.5rem;
              flex-wrap: wrap;
              margin-top: 1rem;
            "
          >
            <label
              class="form-label"
              style="
                margin: 0;
                display: flex;
                align-items: center;
                gap: 0.25rem;
              "
            >
              <input type="checkbox" id="select-stock-checkbox" checked />
              Select Products from stock
            </label>
            <button
              type="button"
              class="btn btn-secondary"
              onclick="alert('Add from stock (demo)')"
            >
              <i class="fas fa-plus"></i> Add From Stock
            </button>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal('add-product-modal')"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i> Save
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Supplier Modal -->
    <div class="modal" id="supplier-modal">
      <div class="modal-content" style="max-width: 600px">
        <div class="modal-header">
          <h2 class="modal-title">Suppliers</h2>
          <button class="modal-close" onclick="closeModal('supplier-modal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="form-group">
          <input
            id="supplier-search"
            class="form-input"
            placeholder="Search suppliers"
            oninput="renderSupplierList()"
          />
        </div>
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Name</th>
                <th style="width: 120px">Actions</th>
              </tr>
            </thead>
            <tbody id="supplier-table-body"></tbody>
          </table>
        </div>
        <div class="modal-footer" style="justify-content: flex-start">
          <button class="btn btn-primary" onclick="openAddSupplierForm()">
            <i class="fas fa-plus"></i> Add Supplier
          </button>
        </div>
      </div>
    </div>

    <!-- Item History Modal -->
    <div class="modal" id="item-history-modal">
      <div class="modal-content" style="max-width: 700px">
        <div class="modal-header">
          <h2 class="modal-title" id="history-title">Item History</h2>
          <button
            class="modal-close"
            onclick="closeModal('item-history-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div style="text-align: center; margin-bottom: 1rem">
          <div class="currency-toggle" id="history-tab-toggle">
            <button
              type="button"
              class="toggle-btn active"
              onclick="switchHistoryTab('table')"
            >
              Table
            </button>
            <button
              type="button"
              class="toggle-btn"
              onclick="switchHistoryTab('chart')"
            >
              Chart
            </button>
          </div>
        </div>
        <div id="history-body"></div>
      </div>
    </div>

    <!-- Refund Modal -->
    <div class="modal" id="refund-modal">
      <div class="modal-content" style="max-width: 800px">
        <div class="modal-header">
          <h2 class="modal-title" id="refund-title">Refund</h2>
          <button class="modal-close" onclick="closeModal('refund-modal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div id="refund-body"></div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            onclick="closeModal('refund-modal')"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            onclick="processRefund()"
          >
            Refund
          </button>
        </div>
      </div>
    </div>

    <!-- Shift Selector Modal -->
    <div class="modal" id="shift-select-modal">
      <div class="modal-content" style="max-width: 360px">
        <div class="modal-header">
          <h2 class="modal-title">Select Shift</h2>
          <button
            class="modal-close"
            onclick="closeModal('shift-select-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div id="shift-list-body"></div>
      </div>
    </div>

    <!-- Import Data Modal -->
    <div class="modal" id="import-data-modal">
      <div class="modal-content" style="max-width: 600px">
        <div class="modal-header">
          <h2 class="modal-title">Import Inventory Data</h2>
          <button class="modal-close" onclick="closeModal('import-data-modal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form onsubmit="event.preventDefault(); importInventoryData();">
          <div class="form-group">
            <label class="form-label">Select File (CSV / Excel)</label>
            <input
              type="file"
              id="inventory-import-file"
              accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"
              class="form-input"
              required
            />
            <div class="form-hint">Supported formats: .csv, .xlsx</div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal('import-data-modal')"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-file-import"></i> Import
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Customer Details Modal -->
    <div class="modal" id="customer-details-modal">
      <div
        class="modal-content"
        style="
          max-width: 900px;
          width: 90%;
          height: 90vh;
          display: flex;
          flex-direction: column;
        "
      >
        <div class="modal-header" style="justify-content: space-between">
          <h2 class="modal-title" id="customer-details-title">
            Customer Details
          </h2>
          <button
            class="modal-close"
            onclick="closeModal('customer-details-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div
          style="
            flex: 1;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
            overflow: hidden;
          "
        >
          <!-- Left: invoices table -->
          <div class="table-wrapper" style="overflow: auto">
            <table class="table">
              <thead>
                <tr>
                  <th>Receipt Nb</th>
                  <th>Time</th>
                  <th>(USD)</th>
                  <th>LBP</th>
                </tr>
              </thead>
              <tbody id="customer-invoices-body"></tbody>
            </table>
          </div>
          <!-- Right side charts -->
          <div style="display: flex; flex-direction: column; gap: 1rem">
            <div
              class="table-wrapper"
              style="
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                border: 1px solid var(--gray-200);
              "
            >
              <h3 style="font-size: 0.9rem; margin-bottom: 0.5rem">
                Total Revenue / Total Profit
              </h3>
              <canvas id="customer-pie" width="150" height="150"></canvas>
            </div>
            <div
              class="table-wrapper"
              style="flex: 1; overflow: auto; border: 1px solid var(--gray-200)"
            >
              <h3 style="font-size: 0.9rem; margin: 0.5rem">
                Top most bought items
              </h3>
              <table class="table" style="margin-top: 0.25rem">
                <thead>
                  <tr>
                    <th>Item</th>
                    <th style="width: 80px">Qty</th>
                  </tr>
                </thead>
                <tbody id="customer-top-items-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal" id="add-user-modal">
      <div class="modal-content" style="max-width: 600px">
        <div class="modal-header">
          <h2 class="modal-title">Add New User</h2>
          <button class="modal-close" onclick="closeModal('add-user-modal')">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="add-user-form" onsubmit="event.preventDefault(); addUser();">
          <div class="form-group">
            <label class="form-label">Full Name</label>
            <input
              type="text"
              id="new-user-name"
              class="form-input"
              placeholder="Full name"
              required
            />
          </div>
          <div class="form-group">
            <label class="form-label">Email Address</label>
            <input
              type="email"
              id="new-user-email"
              class="form-input"
              placeholder="Email"
              required
            />
          </div>
          <div class="form-group">
            <label class="form-label">Role</label>
            <select id="new-user-role" class="form-select" required>
              <option value="user">user</option>
              <option value="sales">sales</option>
              <option value="waiter">waiter</option>
              <option value="admin">admin</option>
              <option value="superadmin">superadmin</option>
              <option value="priceChecker">priceChecker</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Status</label>
            <select id="new-user-status" class="form-select">
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal('add-user-modal')"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i> Save
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Currency Selector Modal -->
    <div class="modal" id="currency-select-modal">
      <div class="modal-content" style="max-width: 340px; width: 90%">
        <div class="modal-header">
          <h2 class="modal-title" id="currency-modal-title">
            Primary Currency
          </h2>
          <button
            class="modal-close"
            onclick="closeModal('currency-select-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div
          id="currency-list-body"
          style="padding: 0.5rem 0; max-height: 60vh; overflow: auto"
        ></div>
      </div>
    </div>

    <!-- Report Period Selector Modals -->
    <div class="modal" id="period-daily-modal">
      <div class="modal-content" style="max-width: 320px">
        <div class="modal-header">
          <h2 class="modal-title">Select Day</h2>
          <button
            class="modal-close"
            onclick="closeModal('period-daily-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <input
          type="date"
          id="report-date-input"
          class="form-input"
          style="width: 100%"
          onchange="setReportDate(this.value)"
        />
      </div>
    </div>
    <div class="modal" id="period-monthly-modal">
      <div class="modal-content" style="max-width: 280px">
        <div class="modal-header">
          <h2 class="modal-title">Select Month</h2>
          <button
            class="modal-close"
            onclick="closeModal('period-monthly-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div
          id="month-grid"
          style="
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            padding: 0.5rem;
          "
        ></div>
      </div>
    </div>
    <div class="modal" id="period-yearly-modal">
      <div class="modal-content" style="max-width: 220px">
        <div class="modal-header">
          <h2 class="modal-title">Select Year</h2>
          <button
            class="modal-close"
            onclick="closeModal('period-yearly-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div
          id="year-list"
          style="padding: 0.5rem; max-height: 50vh; overflow: auto"
        ></div>
      </div>
    </div>
    <!-- END period modals -->

    <!-- Product Quick Action Modal -->
    <div class="modal" id="product-action-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Product Actions</h2>
          <button
            class="modal-close"
            onclick="closeModal('product-action-modal')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div
          style="
            padding: 1rem 0;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
          "
        >
          <button
            class="btn btn-primary quick-action-btn"
            onclick="editSelectedProduct()"
          >
            Edit
          </button>
          <button
            class="btn btn-danger quick-action-btn"
            onclick="deleteSelectedProduct()"
          >
            Delete
          </button>
        </div>
      </div>
    </div>
    <!-- END Product Quick Action Modal -->

    <!-- Payment Modal -->
    <div class="modal" id="payment-modal">
      <div class="modal-content pay-modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Payment</h2>
          <button class="modal-close" onclick="closeModal('payment-modal')"><i class="fas fa-times"></i></button>
        </div>
        <div class="payment-body">
          <div class="toggle-group" id="pay-currency-toggle" style="margin-bottom:0.75rem;">
            <button type="button" class="toggle-btn active" onclick="switchPayCurrency(this,'usd')">USD</button>
            <button type="button" class="toggle-btn" onclick="switchPayCurrency(this,'lbp')">LBP</button>
          </div>
          <div class="payment-info">
            <div class="pay-total" id="pay-total-label">Total: 0.00 USD / 0 LBP</div>
            <div class="pay-received">Received: <span id="pay-received-label">0.00 USD</span></div>
          </div>
          <div class="pay-keypad" id="pay-keypad-container">
            <button onclick="payKeypadAppend('1')">1</button>
            <button onclick="payKeypadAppend('2')">2</button>
            <button onclick="payKeypadAppend('3')">3</button>
            <button onclick="payKeypadAppend('4')">4</button>
            <button onclick="payKeypadAppend('5')">5</button>
            <button onclick="payKeypadAppend('6')">6</button>
            <button onclick="payKeypadAppend('7')">7</button>
            <button onclick="payKeypadAppend('8')">8</button>
            <button onclick="payKeypadAppend('9')">9</button>
            <button onclick="payKeypadAppend('0')">0</button>
            <button onclick="payKeypadAppend('00')">00</button>
            <button onclick="payKeypadAppend('000')">000</button>
          </div>
          <div class="pay-return">Return: <span id="pay-return-label">0.00 USD</span></div>
        </div>
        <div class="modal-footer" style="display:flex;gap:0.5rem;align-items:center;flex-wrap:wrap;">
          <button class="btn btn-primary" onclick="finalizePayment()">Pay</button>
          <button class="btn btn-secondary" onclick="resetPaymentInput()">Reset</button>
          <div style="margin-left:auto;display:flex;gap:0.25rem;">
            <button class="btn btn-secondary btn-icon"><i class="fas fa-print"></i></button>
            <button class="btn btn-secondary btn-icon"><i class="fas fa-ban"></i></button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Global variables
      let cart = [];
      let currentPage = "sale";
      let cartOpen = false;

      // Order type (dinein / delivery)
      let orderType = "dinein";
      function setOrderType(type) {
        orderType = type;
        console.log("Order type set to", type);
      }

      // ---------------- Inventory Data & Helpers ----------------
      /* Sample inventory dataset  replace with real data source when available */
      const inventoryData = [
        {
          name: "Chicken Sub Sand",
          barcode: "1234567890",
          category: "Sandwiches",
          stock: 45,
          cost: 3.5,
          price: 5.99,
        },
        {
          name: "Fahita Sand",
          barcode: "1234567891",
          category: "Sandwiches",
          stock: 32,
          cost: 4.0,
          price: 6.99,
        },
        {
          name: "Chilly Chicken",
          barcode: "1234567892",
          category: "Sandwiches",
          stock: 28,
          cost: 4.5,
          price: 7.99,
        },
      ];

      function getInventoryCategories() {
        return ["All", ...new Set(inventoryData.map((p) => p.category))];
      }

      function formatUsd(value) {
        return `$${value.toLocaleString(undefined, {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        })}`;
      }

      function computeInventoryStats(filterCat = "All") {
        const items =
          filterCat === "All"
            ? inventoryData
            : inventoryData.filter((p) => p.category === filterCat);
        const totalProducts = items.length;
        const totalCost = items.reduce((sum, p) => sum + p.cost * p.stock, 0);
        const totalPrice = items.reduce((sum, p) => sum + p.price * p.stock, 0);
        return { totalProducts, totalCost, totalPrice };
      }

      function generateInventoryRows(filterCat = "All", searchTerm = "") {
        const items = (
          filterCat === "All"
            ? inventoryData
            : inventoryData.filter((p) => p.category === filterCat)
        ).filter((p) => {
          if (!searchTerm) return true;
          const term = searchTerm.toLowerCase();
          return (
            p.name.toLowerCase().includes(term) || p.barcode.includes(term)
          );
        });
        const rows = items
          .map(
            (p) => `
                <tr>
                  <td>${p.name}</td>
                  <td>${p.barcode}</td>
                  <td><span class="badge badge-primary">${
                    p.category
                  }</span></td>
                  <td>${p.stock}</td>
                  <td>${formatUsd(p.cost)}</td>
                  <td>${formatUsd(p.price)}</td>
                  <td>
                    <button class="btn btn-icon btn-secondary" title="Print barcode" onclick="printBarcode('${
                      p.barcode
                    }')"><i class="fas fa-print"></i></button>
                  </td>
                  <td>
                    <button class="btn btn-secondary btn-icon" title="Download Excel" onclick="downloadExcel('${
                      p.barcode
                    }')"><i class="fas fa-file-excel"></i></button>
                    <button class="btn btn-secondary btn-icon" title="History" onclick="openInventoryHistory('${
                      p.barcode
                    }','table')"><i class="fas fa-history"></i></button>
                  </td>
                </tr>`
          )
          .join("");
        return (
          rows ||
          `<tr><td colspan="8" style="text-align:center; padding:2rem; color:var(--gray-500);">No items found</td></tr>`
        );
      }

      function printBarcode(code) {
        alert("Printing barcode: " + code);
      }

      function renderInventory(filterCat = "All", searchTerm = "") {
        const tbody = document.getElementById("inventory-table-body");
        if (tbody)
          tbody.innerHTML = generateInventoryRows(filterCat, searchTerm);

        const stats = computeInventoryStats(filterCat);
        const productEl = document.getElementById("stat-total-products");
        const costEl = document.getElementById("stat-total-cost");
        const priceEl = document.getElementById("stat-total-price");
        if (productEl) productEl.textContent = stats.totalProducts;
        if (costEl) costEl.textContent = formatUsd(stats.totalCost);
        if (priceEl) priceEl.textContent = formatUsd(stats.totalPrice);
      }

      function initInventoryPage() {
        const select = document.getElementById("inventory-category-filter");
        if (select && select.options.length === 0) {
          getInventoryCategories().forEach((cat) => {
            const opt = document.createElement("option");
            opt.value = cat;
            opt.textContent = cat;
            select.appendChild(opt);
          });
        }
        renderInventory(select ? select.value : "All");
        updateDownloadButtonLabel();
      }

      // Event handler wired in HTML
      function filterInventory() {
        const select = document.getElementById("inventory-category-filter");
        const searchInput = document.getElementById("inventory-search-input");
        const term = searchInput ? searchInput.value : "";
        renderInventory(select ? select.value : "All", term);
        updateDownloadButtonLabel();
      }
      // ---------------- End Inventory helpers ----------------

      // Page content functions
      function getSalePage() {
        return `
                <div class="sale-layout">
                    <div class="products-section">
                        <div class="top-row">
                          <div class="categories-container">
                            <div class="categories-header">
                                <h3 class="categories-title">Categories</h3>
                                <div style="display:flex; gap:0.5rem;">
                                    <button class="btn btn-icon btn-secondary" onclick="openModal('category-settings-modal')">
                                        <i class="fas fa-cog"></i>
                                    </button>
                                    <button class="btn btn-icon btn-secondary" onclick="openModal('add-category-modal')">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="categories-grid">
                                <div class="category-card active">
                                    
                                    <span class="category-name">Sandwiches</span>
                                </div>
                                <div class="category-card">
                                    
                                    <span class="category-name">Beef Burger</span>
                                </div>
                                <div class="category-card">
                                    
                                    <span class="category-name">Expert Burger</span>
                                </div>
                                <div class="category-card">
                                    
                                    <span class="category-name">HotDog</span>
                                </div>
                                <div class="category-card">
                                    
                                    <span class="category-name">Appetisers</span>
                                </div>
                                <div class="category-card">
                                    
                                    <span class="category-name">Fried Chicken</span>
                                </div>
                                <div class="category-card">
                                    
                                    <span class="category-name">Meals</span>
                                </div>
                                <div class="category-card">
                                    
                                    <span class="category-name">Beverages</span>
                                </div>
                            </div>
                          </div>
                          <!-- keypad inside top-row -->
                          <div class="keypad-section" style="display:none;">
                            <div class="keypad-grid">
                              ${[9, 8, 7, 6, 5, 4, 3, 2, 1, 0]
                                .map(
                                  (n) =>
                                    `<button class="key-btn" onclick="keypadAppend(${n})">${n}</button>`
                                )
                                .join("")}
                              <button class="key-btn" onclick="keypadClear()">C</button>
                              <button class="key-btn" onclick="keypadAppend(0)">0</button>
                              <button class="key-btn" onclick="keypadDelete()">Del</button>
                            </div>
                          </div>
                        </div>
                        
                        <div class="products-container">
                            <div class="products-header">
                                <h3 class="categories-title">Products</h3>
                                <div class="products-actions">
                                    <button class="btn btn-icon btn-secondary" onclick="openModal('product-settings-modal')">
                                        <i class="fas fa-cog"></i>
                                    </button>
                                    <button class="btn btn-icon btn-secondary" onclick="placeOnHold()">
                                        <i class="fas fa-clock"></i>
                                    </button>
                                    <button class="btn btn-icon btn-secondary" onclick="viewOnHold()">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-icon btn-danger" onclick="clearCart()">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                    <button class="btn btn-icon btn-secondary" onclick="openModal('add-product-modal')">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <!-- Quick-action toolbar below actions -->
                            <div class="products-toolbar">
                                <button class="btn btn-secondary" onclick="placeOnHold()">On Hold</button>
                                <button class="btn btn-secondary" onclick="viewOnHold()">View On Hold</button>
                                <button class="btn btn-danger" onclick="clearCart()">Clean The Basket</button>
                                <button class="btn btn-icon btn-secondary" onclick="openModal('add-product-modal')"><i class="fas fa-plus"></i></button>
                            </div>
                            <div class="products-grid">
                                ${generateProductCards()}
                            </div>
                        </div>
                    </div>
                    
                    <!-- standalone keypad column -->
                    <div class="keypad-section">
                      <div class="keypad-grid">
                        ${[9, 8, 7, 6, 5, 4, 3, 2, 1, 0]
                          .map(
                            (n) =>
                              `<button class="key-btn" onclick="keypadAppend(${n})">${n}</button>`
                          )
                          .join("")}
                        <button class="key-btn" onclick="keypadClear()">C</button>
                        <button class="key-btn" onclick="keypadDelete()">Del</button>
                      </div>
                    </div>
                    
                    <div class="cart-section" id="cart">
                        <div class="cart-header">
                            <div class="cart-title">
                                <i class="fas fa-shopping-cart"></i>
                                Current Order
                                <span class="cart-badge" id="cart-count">0</span>
                                <!-- Order Type Toggle (now positioned beside Current Order) -->
                                <div class="toggle-group order-type-toggle" id="order-type-toggle" style="margin-left:0.75rem;">
                                  <button type="button" class="toggle-btn active" onclick="switchToggle(this); setOrderType('dinein')">Dine In</button>
                                  <button type="button" class="toggle-btn" onclick="switchToggle(this); setOrderType('delivery')">Delivery</button>
                                </div>
                            </div>
                            <div class="customer-section">
                                <div class="select-wrapper">
                                    <select class="select-input">
                                        <option>Walk-in Customer</option>
                                        <option>Samih Damaj</option>
                                    </select>
                                    <i class="fas fa-chevron-down select-icon"></i>
                                </div>
                                <div class="customer-actions">
                                    <button class="customer-btn" onclick="openModal('add-customer-modal')">
                                        <i class="fas fa-plus"></i>
                                        Add
                                    </button>
                                    <button class="customer-btn" onclick="openModal('edit-customer-modal')">
                                        <i class="fas fa-edit"></i>
                                        Edit
                                    </button>
                                </div>
                            </div>
                            <div class="discount-section">
                                <label class="discount-label">Discount:</label>
                                <div class="discount-input-group">
                                    <button class="disc-btn" onclick="changeDiscount(-1)">-</button>
                                    <input type="number" class="discount-input" value="0" min="0" max="100">
                                    <button class="disc-btn" onclick="changeDiscount(1)">+</button>
                                    <span class="discount-symbol">%</span>
                                </div>
                                <!-- Discount Slider -->
                                <input type="range" class="discount-slider" min="0" max="100" value="0" style="width:120px;margin-left:0.75rem;" oninput="updateDiscountFromSlider(this.value)">
                            </div>
                        </div>
                        
                        <div class="cart-items" id="cart-items">
                            <div class="empty-cart">
                                <i class="fas fa-shopping-basket empty-cart-icon"></i>
                                <span class="empty-cart-text">Your cart is empty</span>
                            </div>
                        </div>
                        
                        <div class="cart-footer">
                            <div class="cart-summary">
                                <div class="summary-row">
                                    <span class="summary-label">Subtotal</span>
                                    <span class="summary-value" id="subtotal">$0.00</span>
                                </div>
                                <div class="summary-row">
                                    <span class="summary-label">Discount</span>
                                    <span class="summary-value" id="discount-amount">$0.00</span>
                                </div>
                                <div class="summary-row">
                                    <span class="summary-label">Tax (10%)</span>
                                    <span class="summary-value" id="tax-amount">$0.00</span>
                                </div>
                                <div class="summary-row total" style="align-items:center;gap:0.5rem;">
                                    <span class="summary-label">Total</span>
                                    <span class="summary-value" id="total-amount">$0.00</span>
                                </div>
                                <div class="summary-row" style="align-items:center;gap:0.5rem;">
                                    <span class="summary-label">Total (LBP)</span>
                                    <span class="summary-value" id="total-amount-lbp">0 LBP</span>
                                    <button class="btn btn-secondary btn-sm" id="invoice-btn" onclick="openInvoiceFromCart()"><i class="fas fa-file-alt"></i> Invoice</button>
                                </div>
                            </div>
                            <div class="cart-actions">
                                <button class="btn btn-secondary" onclick="openDrawer()">
                                    <i class="fas fa-cash-register"></i>
                                    Open Drawer
                                </button>
                                <button class="btn btn-primary" onclick="processPayment()">
                                    <i class="fas fa-credit-card"></i>
                                    Pay Now
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
      }

      function generateProductCards() {
        const products = [
          { name: "Chicken Sub Sand", price: 5.99, icon: "" },
          { name: "Fahita Sand", price: 6.99, icon: "" },
          { name: "Chilly Chicken", price: 7.99, icon: "", badge: "HOT" },
          { name: "Special Crispy", price: 8.99, icon: "" },
          { name: "Escalope Sand", price: 6.49, icon: "" },
          { name: "Crispy Sand", price: 5.49, icon: "" },
          { name: "Mexicana Sand", price: 9.99, icon: "", badge: "NEW" },
          { name: "Cheesy Chicken", price: 7.49, icon: "" },
          { name: "Chicken Sub Sand", price: 5.99, icon: "" },
          { name: "Fahita Sand", price: 6.99, icon: "" },
          { name: "Chilly Chicken", price: 7.99, icon: "", badge: "HOT" },
          { name: "Special Crispy", price: 8.99, icon: "" },
          { name: "Escalope Sand", price: 6.49, icon: "" },
          { name: "Crispy Sand", price: 5.49, icon: "" },
          { name: "Mexicana Sand", price: 9.99, icon: "", badge: "NEW" },
          { name: "Cheesy Chicken", price: 7.49, icon: "" },
          { name: "Chicken Sub Sand", price: 5.99, icon: "" },
          { name: "Fahita Sand", price: 6.99, icon: "" },
          { name: "Chilly Chicken", price: 7.99, icon: "", badge: "HOT" },
          { name: "Special Crispy", price: 8.99, icon: "" },
          { name: "Escalope Sand", price: 6.49, icon: "" },
          { name: "Crispy Sand", price: 5.49, icon: "" },
          { name: "Mexicana Sand", price: 9.99, icon: "", badge: "NEW" },
          { name: "Cheesy Chicken", price: 7.49, icon: "" },
          { name: "Chicken Sub Sand", price: 5.99, icon: "" },
          { name: "Fahita Sand", price: 6.99, icon: "" },
          { name: "Chilly Chicken", price: 7.99, icon: "", badge: "HOT" },
          { name: "Special Crispy", price: 8.99, icon: "" },
          { name: "Escalope Sand", price: 6.49, icon: "" },
          { name: "Crispy Sand", price: 5.49, icon: "" },
          { name: "Mexicana Sand", price: 9.99, icon: "", badge: "NEW" },
          { name: "Cheesy Chicken", price: 7.49, icon: "" },
          { name: "Chicken Sub Sand", price: 5.99, icon: "" },
          { name: "Fahita Sand", price: 6.99, icon: "" },
          { name: "Chilly Chicken", price: 7.99, icon: "", badge: "HOT" },
          { name: "Special Crispy", price: 8.99, icon: "" },
          { name: "Escalope Sand", price: 6.49, icon: "" },
          { name: "Crispy Sand", price: 5.49, icon: "" },
          { name: "Mexicana Sand", price: 9.99, icon: "", badge: "NEW" },
          { name: "Cheesy Chicken", price: 7.49, icon: "" },
          { name: "Chicken Sub Sand", price: 5.99, icon: "" },
          { name: "Fahita Sand", price: 6.99, icon: "" },
          { name: "Chilly Chicken", price: 7.99, icon: "", badge: "HOT" },
          { name: "Special Crispy", price: 8.99, icon: "" },
          { name: "Escalope Sand", price: 6.49, icon: "" },
          { name: "Crispy Sand", price: 5.49, icon: "" },
          { name: "Mexicana Sand", price: 9.99, icon: "", badge: "NEW" },
          { name: "Cheesy Chicken", price: 7.49, icon: "" },
          { name: "Chicken Sub Sand", price: 5.99, icon: "" },
          { name: "Fahita Sand", price: 6.99, icon: "" },
          { name: "Chilly Chicken", price: 7.99, icon: "", badge: "HOT" },
          { name: "Special Crispy", price: 8.99, icon: "" },
          { name: "Escalope Sand", price: 6.49, icon: "" },
          { name: "Crispy Sand", price: 5.49, icon: "" },
          { name: "Mexicana Sand", price: 9.99, icon: "", badge: "NEW" },
          { name: "Cheesy Chicken", price: 7.49, icon: "" },
          { name: "Chicken Sub Sand", price: 5.99, icon: "" },
          { name: "Fahita Sand", price: 6.99, icon: "" },
          { name: "Chilly Chicken", price: 7.99, icon: "", badge: "HOT" },
          { name: "Special Crispy", price: 8.99, icon: "" },
          { name: "Escalope Sand", price: 6.49, icon: "" },
          { name: "Crispy Sand", price: 5.49, icon: "" },
          { name: "Mexicana Sand", price: 9.99, icon: "", badge: "NEW" },
          { name: "Cheesy Chicken", price: 7.49, icon: "" },
          { name: "Chicken Sub Sand", price: 5.99, icon: "" },
          { name: "Fahita Sand", price: 6.99, icon: "" },
          { name: "Chilly Chicken", price: 7.99, icon: "", badge: "HOT" },
          { name: "Special Crispy", price: 8.99, icon: "" },
          { name: "Escalope Sand", price: 6.49, icon: "" },
          { name: "Crispy Sand", price: 5.49, icon: "" },
          { name: "Mexicana Sand", price: 9.99, icon: "", badge: "NEW" },
          { name: "Cheesy Chicken", price: 7.49, icon: "" },
        ];

        return products
          .map(
            (product) => `
                <div class="product-card" onclick="addToCart('${
                  product.name
                }', ${product.price})">
                    <div class="product-image">
                        ${
                          product.badge
                            ? `<span class="product-badge">${product.badge}</span>`
                            : ""
                        }
                        ${product.icon}
                    </div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-meta">
                            <span class="product-price">$${product.price.toFixed(
                              2
                            )}</span>
                            <span class="product-stock">In Stock</span>
                        </div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function getDailySalesPage() {
        return `
          <div class="table-container">
            <div class="table-header" style="display:flex;justify-content:space-between;align-items:center;gap:0.75rem;flex-wrap:wrap;">
              <div class="day-buttons" style="display:flex;gap:0.5rem;overflow-x:auto;max-width:50%;">
                <button style="min-width:80px" class="btn btn-secondary">Jul 5</button>
                <button style="min-width:80px"  class="btn btn-secondary">Jul 6</button>
                <button style="min-width:80px" class="btn btn-secondary">Jul 7</button>
                <button style="min-width:80px" class="btn btn-secondary">Jul 8</button>
                <button style="min-width:80px" class="btn btn-secondary">Jul 9</button>
                <button style="min-width:80px" class="btn btn-secondary">Jul 10</button>
                <button style="min-width:80px" class="btn btn-primary">TODAY</button>
              </div>
              <div class="table-actions" style="display:flex;gap:0.5rem;align-items:center;">
                  <select id="daily-category-select" class="form-select" style="min-width:160px;">
                  <option value="">All</option>
                  <option value="sales">Sales</option>
                  <option value="deposit">Deposit</option>
                  <option value="expenses">Expenses</option>
                </select>
                <input type="date" id="daily-date-picker" style="display:none;" onchange="filterDailySalesByDate(this.value)">
                <button style="min-width:40px;min-height:40px" class="btn btn-secondary btn-icon" onclick="(document.getElementById('daily-date-picker').showPicker?document.getElementById('daily-date-picker').showPicker():document.getElementById('daily-date-picker').click())"><i class="fas fa-calendar-alt"></i></button>
                <button style="min-width:40px;min-height:40px" class="btn btn-secondary btn-icon" id="daily-stats-toggle" onclick="toggleDailyStats()"><i class="fas fa-chart-bar"></i></button>
              
                <button style="min-width:40px;min-height:40px" class="btn btn-secondary btn-icon"><i class="fas fa-file-excel"></i></button>
                <button style="min-width:40px;min-height:40px" class="btn btn-secondary btn-icon"><i class="fas fa-print"></i></button>
                <button style="min-width:40px;min-height:40px" class="btn btn-icon" onclick="openModal('add-transaction-modal')" title="Add Transaction"><i class="fas fa-plus"></i></button>
              </div>
            </div>

           <div id="daily-stats-section" class="stats-grid" style="display:flex;gap:1rem;overflow-x:auto;">
  <div class="stat-card">
    <div class="stat-icon-wrapper success"><i class="fas fa-dollar-sign"></i></div>
    <div class="stat-details">
      <div class="stat-label">Sales</div>
      <div class="stat-value">$0.00</div>
      <div class="stat-value">0 LBP</div>
    </div>
  </div>

  <div class="stat-card">
    <div class="stat-icon-wrapper primary"><i class="fas fa-piggy-bank"></i></div>
    <div class="stat-details">
      <div class="stat-label">Deposit</div>
      <div class="stat-value">$0.00</div>
      <div class="stat-value">0 LBP</div>
    </div>
  </div>

  <div class="stat-card">
    <div class="stat-icon-wrapper danger"><i class="fas fa-receipt"></i></div>
    <div class="stat-details">
      <div class="stat-label">Expenses</div>
      <div class="stat-value">$0.00</div>
      <div class="stat-value">0 LBP</div>
    </div>
  </div>

  <div class="stat-card">
    <div class="stat-icon-wrapper warning"><i class="fas fa-wallet"></i></div>
    <div class="stat-details">
      <div class="stat-label">From Cash</div>
      <div class="stat-value">$0.00</div>
      <div class="stat-value">0 LBP</div>
    </div>
  </div>
</div>

            <div class="table-wrapper">
              <table class="table">
                <thead>
                  <tr>
                    <th style="min-width:140px;">Receipt ID<br><input type="text" class="form-input" placeholder="Search..." style="width:100%;margin-top:4px;" oninput="filterDailySalesBySearch(this.value)"></th>
                    <th>Time</th>
                    <th>Amount (USD)</th>
                    <th>Amount (LBP)</th>
                    <th>Payment Type</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="daily-sales-tbody">
                  <tr>
                    <td colspan="6" style="text-align:center;padding:3rem;color:var(--gray-500);">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        `;
      }

      function getShiftPage() {
        return `
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Shift Management</h2>
                        <button class="btn btn-primary">
                            <i class="fas fa-sign-out-alt"></i>
                            End Shift
                        </button>
                    </div>
                    <div style="padding: 1.5rem;">
                        <div style="width:100%;display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;">
                            <!-- Shift Info Lines -->
                            <div style="display:flex;flex-direction:column;gap:0.5rem;">
                                <div class="shift-info-card">
                                    <i class="fas fa-clock"></i>
                                    <span>Current Shift :</span>
                                    <span class="shift-number">#266</span>
                                    <span class="shift-time">- 14-05-2025 11:55 PM  now</span>
                                </div>
                                <div class="shift-info-card">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Selected Shift :</span>
                                    <span class="shift-number">#266</span>
                                    <span class="shift-time">- 14-05-2025 11:55 PM  now</span>
                                    <button class="btn btn-secondary btn-sm" style="margin-left:0.5rem;" onclick="openShiftSelector()">Open latest Shifts</button>
                                </div>
                            </div>

                            <!-- Summary + Net -->
                            <div style="display:flex; gap:1rem; align-items:center; flex-wrap:wrap; margin-bottom:1.5rem;">
                                <div class="shift-summary">
                                    <div class="summary-row"><span class="summary-label">Sales :</span> <span>16289.265 USD&nbsp;|&nbsp;1,466,033,868 LBP</span></div>
                                    <div class="summary-row"><span class="summary-label">Deposit :</span> <span>0.0 USD&nbsp;|&nbsp;0.0 LBP</span></div>
                                    <div class="summary-row"><span class="summary-label">Expenses :</span> <span>4315.26 USD&nbsp;|&nbsp;11.0 LBP</span></div>
                                    <div class="cash-box">from cash : 3,246.9 USD<br>11.0 LBP</div>
                                </div>
                                <div class="shift-net">&nbsp;&nbsp;--&gt; 13,042.405 USD</div>
                            </div>
                        </div>
                        <!-- Action Buttons Row -->
                        <div style="display:flex; gap:0.75rem; align-items:center;justify-content:flex-end; margin-bottom:1rem; flex-wrap:wrap;">
                            <button class="btn btn-secondary">All <i class="fas fa-chevron-down"></i></button>
                            <button class="btn btn-secondary" id="balance-toggle-inside" style="margin-left:0.25rem;" onclick="toggleShiftBalance()">Hide Balance</button>
                            <button class="btn btn-download"><i class="fas fa-download"></i> download</button>
                            <!-- End Shift button removed as per spec -->
                        </div>

                        
                        <div class="table-wrapper">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Receipt No.</th>
                                        <th>Time</th>
                                        <th>Amount (USD)</th>
                                        <th>Amount (LBP)</th>
                                        <th>Payment Type</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="shift-receipts-body">
                                    <tr><td colspan="6" style="text-align:center;padding:1rem;color:var(--gray-500);">No receipts</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
      }

      function getInventoryPage() {
        return `
          <div class="table-container">
            <div class="table-header">
              <h2 class="table-title">Inventory Management</h2>
              <div class="table-actions" style="display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap;">
                <div class="toggle-group">
                  <button type="button" class="toggle-btn active" onclick="switchToggle(this)">Active</button>
                  <button type="button" class="toggle-btn" onclick="switchToggle(this)">Deleted</button>
                </div>
                <button id="download-stock-btn" class="btn btn-secondary" onclick="downloadInventoryStock()"><i class="fas fa-download"></i> Download All Stock</button>
                <button class="btn btn-secondary" onclick="openModal('import-data-modal')"><i class="fas fa-file-import"></i> Import Data</button>
                <button class="btn btn-secondary btn-icon" onclick="openModal('product-settings-modal')"><i class="fas fa-cog"></i></button>
                <button class="btn btn-primary" onclick="openModal('add-product-modal')"><i class="fas fa-plus"></i> Add</button>
              </div>
            </div>
            <div style="padding:1.5rem;">
              <!-- SEARCH ROW -->
              <div style="display:flex; align-items:center; gap:0.75rem; margin-bottom:1rem; flex-wrap:wrap;">
                <input id="inventory-search-input" class="form-input" style="flex:1; min-width:220px;" placeholder="search by name or barcode" oninput="filterInventory()" />
                <label class="form-label" style="margin:0;">Filter by Category:</label>
                <select id="inventory-category-filter" class="form-select" style="width:auto; min-width:180px;" onchange="filterInventory()"></select>
              </div>

              <!-- STATS -->
              <div class="stats-grid" style="margin-bottom:1.5rem;" id="inventory-stats">
                <div class="stat-card">
                  <div class="stat-icon-wrapper primary"><i class="fas fa-box"></i></div>
                  <div class="stat-details">
                    <div class="stat-label">Total Products</div>
                    <div class="stat-value" id="stat-total-products">0</div>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon-wrapper warning"><i class="fas fa-money-bill-wave"></i></div>
                  <div class="stat-details">
                    <div class="stat-label">Total Cost</div>
                    <div class="stat-value" id="stat-total-cost">$0.00</div>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon-wrapper success"><i class="fas fa-dollar-sign"></i></div>
                  <div class="stat-details">
                    <div class="stat-label">Total Price</div>
                    <div class="stat-value" id="stat-total-price">$0.00</div>
                  </div>
                </div>
              </div>

              <!-- TABLE -->
              <div class="table-wrapper">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Product</th>
                      <th>Barcode</th>
                      <th>Category</th>
                      <th>Stock</th>
                      <th>Cost</th>
                      <th>Price</th>
                      <th>Print</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="inventory-table-body"></tbody>
                </table>
              </div>
            </div>
          </div>`;
      }

      function getPurchasesPage() {
        return `
          <div style="padding:1rem;">
            <!-- Totals Row -->
            <div class="purchase-totals">
              <span class="purchase-total-label">
                TOTAL: <span id="purchase-total-usd">0.0 USD</span> / <span id="purchase-total-lbp">0.0 LBP</span> , Qty: <span id="purchase-total-qty">0.0</span>
              </span>
              <input id="purchase-reference" class="form-input" placeholder="reference id" style="max-width:160px;" />
              <input id="purchase-date" class="form-input" type="date" style="max-width:160px;" />
              <button class="btn btn-secondary" onclick="openSupplierModal()"><i class="fas fa-search"></i> Supplier</button>
            </div>

            <!-- Search / Actions Row -->
            <div class="purchase-actions">
              <input id="purchase-search" class="form-input" style="flex:1;min-width:240px;" placeholder="search by name or barcode" onkeydown="handlePurchaseSearch(event)" />
              <button class="btn btn-secondary" onclick="openModal('add-product-modal')"><i class="fas fa-plus"></i> Add Product</button>
              <button class="btn btn-success" onclick="savePurchase()"><i class="fas fa-save"></i> save</button>
            </div>

            <!-- Items Container -->
            <div id="purchase-items-container"></div>
          </div>
        `;
      }

      function getCustomersPage() {
        return `
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Customer Management</h2>
                        <div class="table-actions">
                            <button class="btn btn-secondary">
                                <i class="fas fa-file-import"></i>
                                Import
                            </button>
                            <button class="btn btn-primary" onclick="openModal('add-customer-modal')">
                                <i class="fas fa-plus"></i>
                                New Customer
                            </button>
                        </div>
                    </div>
                    <div style="padding: 1.5rem;">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon-wrapper purple">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-details">
                                    <div class="stat-label">Total Customers</div>
                                    <div class="stat-value">1</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon-wrapper success">
                                    <i class="fas fa-user-check"></i>
                                </div>
                                <div class="stat-details">
                                    <div class="stat-label">Active Customers</div>
                                    <div class="stat-value">1</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon-wrapper primary">
                                    <i class="fas fa-percentage"></i>
                                </div>
                                <div class="stat-details">
                                    <div class="stat-label">Avg. Discount</div>
                                    <div class="stat-value">0%</div>
                                </div>
                            </div>
                        </div>
                        <div class="table-wrapper" style="margin-top: 1.5rem;">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Phone</th>
                                        <th>Email</th>
                                        <th>Address</th>
                                        <th>Discount</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Samih Damaj</td>
                                        <td>71940445</td>
                                        <td>-</td>
                                        <td>Sebline 7ay m3sra</td>
                                        <td><span class="badge badge-primary">0%</span></td>
                                        <td><span class="badge badge-success">Active</span></td>
                                        <td>
                                            <button class="btn btn-secondary btn-icon" title="Details" onclick="openCustomerDetails('Samih Damaj')"><i class="fas fa-eye"></i></button>
                                            <button class="btn btn-secondary btn-icon" onclick="openModal('edit-customer-modal')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-danger btn-icon">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
      }

      function getUsersPage() {
        return `
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">User Management</h2>
                        <button class="btn btn-primary" onclick="openModal('add-user-modal')">
                            <i class="fas fa-user-plus"></i>
                            New User
                        </button>
                    </div>
                    <div style="padding: 1.5rem;">
                        <div class="table-wrapper">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Last Login</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table-body">
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <div class="user-avatar" style="width: 32px; height: 32px; font-size: 0.875rem;">MA</div>
                                                <div>
                                                    <div style="font-weight: 600;">Meat and Cheese</div>
                                                    <div style="font-size: 0.75rem; color: var(--gray-500);">Administrator</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>mohamad@gmail.com</td>
                                        <td><span class="badge badge-primary">Superadmin</span></td>
                                        <td><span class="badge badge-success">Active</span></td>
                                        <td>Today, 2:30 PM</td>
                                        <td>
                                            <button class="btn btn-secondary btn-icon">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <div class="user-avatar" style="width: 32px; height: 32px; font-size: 0.875rem; background: linear-gradient(135deg, #8b5cf6, #6366f1);">AD</div>
                                                <div>
                                                    <div style="font-weight: 600;">Abd</div>
                                                    <div style="font-size: 0.75rem; color: var(--gray-500);">Staff Member</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>user@example.com</td>
                                        <td><span class="badge badge-success">User</span></td>
                                        <td><span class="badge badge-success">Active</span></td>
                                        <td>Yesterday, 5:15 PM</td>
                                        <td>
                                            <button class="btn btn-secondary btn-icon">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-danger btn-icon">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                                <div class="user-avatar" style="width: 32px; height: 32px; font-size: 0.875rem; background: linear-gradient(135deg, #f59e0b, #f97316);">MZ</div>
                                                <div>
                                                    <div style="font-weight: 600;">Mazen</div>
                                                    <div style="font-size: 0.75rem; color: var(--gray-500);">Manager</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>mazen@example.com</td>
                                        <td><span class="badge badge-primary">Admin</span></td>
                                        <td><span class="badge badge-success">Active</span></td>
                                        <td>3 days ago</td>
                                        <td>
                                            <button class="btn btn-secondary btn-icon">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-danger btn-icon">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
      }

      function getSettingsPage() {
        return `
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1.5rem;">
            <!-- Printer Properties (left top) -->
            <div class="table-container">
              <div class="table-header">
                <h2 class="table-title">Printer Properties</h2>
                <button class="btn btn-primary"><i class="fas fa-save"></i> save</button>
              </div>
              <div style="padding:1.5rem; display:flex; flex-direction:column; gap:1rem;">
                <div class="form-group"><label class="form-label">Selected Printer :</label><input class="form-input" placeholder="Printer Name" style="position:relative; padding-right:2rem;"><i class="fas fa-search" style="position:absolute; right:1rem; top:50%; transform:translateY(-50%); color:var(--gray-500);"></i></div>
                <div class="settings-item"><i class="fas fa-network-wired settings-icon"></i><span class="settings-label">Network Printers ?</span><div class="toggle-group"><button type="button" class="toggle-btn active" onclick="switchToggle(this)">On</button><button type="button" class="toggle-btn" onclick="switchToggle(this)">Off</button></div></div>
                <div class="settings-item"><i class="fas fa-font settings-icon"></i><span class="settings-label">Basket font size</span><input type="number" class="form-input" value="20.0" style="max-width:120px;"></div>
                <div class="settings-item"><i class="fas fa-font settings-icon"></i><span class="settings-label">basketWidth</span><input type="number" class="form-input" value="500.0" style="max-width:120px;"></div>
                ${[
                  "Show open cash button",
                  "Open change Dialog on pay",
                  "Print Receipt ?",
                  "Print Basket Items In USD ?",
                  "Print Receipt USD ?",
                  "Print Receipt LBP ?",
                  "Print label on Label Printer ?",
                  "print small label 3020 ?",
                ]
                  .map(
                    (l) =>
                      `<div class="settings-item"><i class="fas fa-eye settings-icon"></i><span class="settings-label">${l}</span><div class="toggle-group"><button type="button" class="toggle-btn active" onclick="switchToggle(this)">On</button><button type="button" class="toggle-btn" onclick="switchToggle(this)">Off</button></div></div>`
                  )
                  .join("")}
                <div class="settings-item"><i class="fas fa-receipt settings-icon"></i><span class="settings-label">Receipt Nb</span><input type="number" class="form-input" value="1" style="max-width:160px;"></div>
              </div>
            </div>
            <!-- Store Info (right top) -->
            <div class="table-container">
              <div class="table-header"><h2 class="table-title">Store Info</h2><button class="btn btn-primary"><i class="fas fa-save"></i> save</button></div>
              <div style="padding:1.5rem; display:flex; flex-direction:column; gap:1rem;">
                <div class="form-group"><label class="form-label">Store Qr Code</label><input class="form-input" placeholder="store Qr Code"></div>
                <div class="form-group"><label class="form-label">Name</label><input class="form-input" value="MEAT AND CHEESE"></div>
                <div class="form-group"><label class="form-label">Address</label><input class="form-input" value="BARJA"></div>
                <div class="form-group"><label class="form-label">Phone</label><input class="form-input" value="81109698"></div>
                <div class="form-group"><label class="form-label">Note</label><input class="form-input" placeholder="Note"></div>
                <button class="btn btn-secondary"><i class="fas fa-image"></i> pick logo</button>
                <div class="settings-item"><i class="fas fa-print settings-icon"></i><span class="settings-label">Print logo on invoice</span><div class="toggle-group"><button type="button" class="toggle-btn active" onclick="switchToggle(this)">On</button><button type="button" class="toggle-btn" onclick="switchToggle(this)">Off</button></div></div>
              </div>
            </div>
            <!-- General Section (left bottom) -->
            <div class="table-container">
              <div class="table-header"><h2 class="table-title">General Section</h2></div>
              <div style="padding:1rem; display:flex; flex-direction:column; gap:0.75rem;">
                ${[
                  "Open the system in full screen mode",
                  "Show table button",
                  "Allow negative discount",
                  "Show Select Module Screen",
                  "Show Order Type Section ?",
                  "Show Restaurant Stock ?",
                ]
                  .map(
                    (l) =>
                      `<div class="settings-item"><i class="fas fa-eye settings-icon"></i><span class="settings-label">${l}</span><div class="toggle-group"><button type="button" class="toggle-btn active" onclick="switchToggle(this)">On</button><button type="button" class="toggle-btn" onclick="switchToggle(this)">Off</button></div></div>`
                  )
                  .join("")}
                <div class="settings-item"><i class="fas fa-language settings-icon"></i><span class="settings-label">Language</span><button class="btn btn-secondary">En <i class="fas fa-chevron-right"></i></button></div>
                <div class="settings-item"><i class="fas fa-cloud settings-icon"></i><span class="settings-label">Backup</span><button class="btn btn-secondary"><i class="fas fa-chevron-right"></i></button></div>
                <div class="settings-item"><i class="fas fa-history settings-icon"></i><span class="settings-label">Restore Data</span><button class="btn btn-secondary"><i class="fas fa-chevron-right"></i></button></div>
                <div style="text-align:right; margin-top:0.5rem;"><button class="btn btn-secondary">Backup (3)</button></div>
              </div>
            </div>
            <!-- Currencies (right bottom) -->
            <div class="table-container">
              <div class="table-header"><h2 class="table-title">Currencies</h2><button class="btn btn-primary"><i class="fas fa-save"></i> save</button></div>
              <div style="padding:1rem; display:flex; flex-direction:column; gap:1rem;">
                <div class="settings-item"><i class="fas fa-dollar-sign settings-icon"></i><span class="settings-label">Primary Currency</span><button id="primary-currency-btn" class="btn btn-secondary" onclick="openCurrencySelector('primary')">USD <i class="fas fa-chevron-right"></i></button></div>
                <div class="settings-item"><i class="fas fa-dollar-sign settings-icon"></i><span class="settings-label">Secondary Currency</span><button id="secondary-currency-btn" class="btn btn-secondary" onclick="openCurrencySelector('secondary')">LBP <i class="fas fa-chevron-right"></i></button></div>
              </div>
            </div>
          </div>`;
      }

      function getReportsPage() {
        return `
          <div class="table-container" style="border:none;">
            <!-- PERIOD TOGGLE -->
            <div style="display:flex; gap:0.5rem; margin-bottom:1rem;">
              <button id="rep-daily-btn" class="btn btn-secondary" onclick="openReportPeriod('daily')">DAILY</button>
              <button id="rep-monthly-btn" class="btn btn-primary" onclick="openReportPeriod('monthly')">MONTHLY</button>
              <button id="rep-yearly-btn" class="btn btn-secondary" onclick="openReportPeriod('yearly')">YEARLY</button>
            </div>

            <!-- HEADER LINE -->
            <h2 style="color:var(--danger); font-size:1.2rem; margin-bottom:0.75rem;">
              Profit Report ( <span id="report-period-label">monthly - Jun 2025</span> ) => <span id="report-total-usd">2899.787</span> USD
            </h2>

            <!-- REPORT TABS NAV -->
            <div style="display:flex; gap:1.5rem; margin-bottom:0.5rem; font-weight:600; border-bottom:2px solid var(--gray-200);">
              <div style="padding-bottom:0.25rem; cursor:pointer;" class="rep-tab-link active" onclick="switchReportTab(0)">Sales</div>
              <div style="padding-bottom:0.25rem; cursor:pointer;" class="rep-tab-link" onclick="switchReportTab(1)">Sales by categories</div>
              <div style="padding-bottom:0.25rem; cursor:pointer;" class="rep-tab-link" onclick="switchReportTab(2)">Expenses / <span id="exp-total">1581.39</span> USD</div>
              <div style="padding-bottom:0.25rem; cursor:pointer;" class="rep-tab-link" onclick="switchReportTab(3)">Report charts</div>
            </div>

            <!-- TAB CONTENTS -->
            <div id="rep-tab-0" class="rep-tab-content active" style="padding-top:1rem;"></div>
            <div id="rep-tab-1" class="rep-tab-content" style="display:none; padding-top:1rem;"></div>
            <div id="rep-tab-2" class="rep-tab-content" style="display:none; padding-top:1rem;"></div>
            <div id="rep-tab-3" class="rep-tab-content" style="display:none; padding-top:1rem; display:flex; gap:2rem; flex-wrap:wrap;"></div>
          </div>`;
      }

      function getDashboardPage() {
        return `
            <div>
               
                <!-- Period selector -->
                <div class="period-toggle">
                    <button class="period-btn">Last year</button>
                    <button class="period-btn active">Last month</button>
                    <button class="period-btn">Yesterday</button>
                    <button class="period-btn">Today</button>
                    <button class="period-btn">This week</button>
                    <button class="period-btn">This month</button>
                    <button class="period-btn">This year</button>
                </div>

                <!-- Quick stats -->
                <div class="quick-stats-grid">
                    <div class="quick-stat-card products">
                        <div class="quick-stat-value">92</div>
                        <div class="quick-stat-label">Products</div>
                    </div>
                    <div class="quick-stat-card receipts">
                        <div class="quick-stat-value">506</div>
                        <div class="quick-stat-label">Receipts</div>
                    </div>
                    <div class="quick-stat-card customers">
                        <div class="quick-stat-value">1</div>
                        <div class="quick-stat-label">Customers</div>
                    </div>
                    <div class="quick-stat-card users">
                        <div class="quick-stat-value">3</div>
                        <div class="quick-stat-label">Users</div>
                    </div>
                    <div class="quick-stat-card warnings">
                        <div class="quick-stat-value">0</div>
                        <div class="quick-stat-label">Stock warning</div>
                    </div>
                </div>

                <!-- Dashboard charts grid -->
                <div class="dashboard-grid">
                    <div class="chart-container">
                      <div class="chart-header">
                        <h3 class="chart-title">Top 10 Selling Products</h3>
                        <button class="btn btn-secondary btn-icon"><i class="fas fa-expand"></i></button>
                      </div>
                      <div style="padding: 1rem;">
                        <canvas id="topProductsChart"></canvas>
                      </div>
                    </div>

                    <div class="chart-container">
                      <div class="chart-header">
                        <h3 class="chart-title">Expenses (1581.39 USD)</h3>
                        <button class="btn btn-secondary btn-icon"><i class="fas fa-expand"></i></button>
                      </div>
                      <div style="padding: 1rem;">
                        <canvas id="expensesChart"></canvas>
                      </div>
                    </div>

                    <div class="chart-container">
                      <div class="chart-header">
                        <h3 class="chart-title">Sales by users <span style="color:var(--danger);font-weight:600;">7351.23 USD</span></h3>
                        <button class="btn btn-secondary btn-icon"><i class="fas fa-expand"></i></button>
                      </div>
                      <div style="padding: 1rem;">
                        <canvas id="salesByUsersChart"></canvas>
                      </div>
                    </div>

                    <div class="chart-container">
                      <div class="chart-header">
                        <h3 class="chart-title">SALES Last month</h3>
                        <button class="btn btn-secondary btn-icon"><i class="fas fa-expand"></i></button>
                      </div>
                      <div style="padding: 1rem;">
                        <canvas id="monthlySalesChart"></canvas>
                      </div>
                    </div>

                    <div class="chart-container">
                      <div class="chart-header">
                        <h3 class="chart-title">Hourly Customers Last month</h3>
                        <button class="btn btn-secondary btn-icon"><i class="fas fa-expand"></i></button>
                      </div>
                      <div style="padding: 1rem;">
                        <canvas id="hourlyCustomersChart"></canvas>
                      </div>
                    </div>

                    <div class="chart-container">
                      <div class="chart-header">
                        <h3 class="chart-title">Top 10 spending Customers</h3>
                        <button class="btn btn-secondary btn-icon"><i class="fas fa-expand"></i></button>
                      </div>
                      <div style="padding: 1rem;">
                        <canvas id="topCustomersChart"></canvas>
                      </div>
                    </div>
                </div>
            </div>
        `;
      }

      // Cart functions
      function addToCart(name, price) {
        let idx = cart.findIndex((item) => item.name === name);
        if (idx !== -1) {
          cart[idx].quantity++;
        } else {
          cart.push({ name, price, quantity: 1, discount: 0 });
          idx = cart.length - 1;
        }
        selectedCartIndex = idx;
        keypadBuffer = "";
        updateCartDisplay();
      }

      function updateCartDisplay() {
        const cartItems = document.getElementById("cart-items");
        const cartCount = document.getElementById("cart-count");
        const subtotal = document.getElementById("subtotal");
        const discountAmount = document.getElementById("discount-amount");
        const taxAmount = document.getElementById("tax-amount");
        const totalAmount = document.getElementById("total-amount");

        if (!cartItems) return;

        if (cart.length === 0) {
          cartItems.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-basket empty-cart-icon"></i>
                        <span class="empty-cart-text">Your cart is empty</span>
                    </div>
                `;
          if (cartCount) cartCount.textContent = "0";
          if (subtotal) subtotal.textContent = "$0.00";
          if (discountAmount) discountAmount.textContent = "$0.00";
          if (taxAmount) taxAmount.textContent = "$0.00";
          if (totalAmount) totalAmount.textContent = "$0.00";
          return;
        }

        let subtotalValue = 0;
        const headerRow = `<div class="cart-header-row">
                              <span>Item</span>
                              <span>Qty</span>
                              <span>Total</span>
                              <span></span>
                            </div>`;
        cartItems.innerHTML = headerRow + cart.map((item,index)=>{
            const total = item.price*item.quantity*(1-(item.discount||0)/100);
            subtotalValue += total;
            return `<div class="cart-item fade-in${selectedCartIndex===index?' selected':''}" id="cart-item-${index}" onclick="selectCartItem(${index})">
                        <span class="ci-name">${item.name}${item.discount?`<br><span class='ci-disc'>-${item.discount}%</span>`:''}</span>
                        <span class="ci-qty">${item.quantity}</span>
                        <span class="ci-price">${total.toFixed(2)}</span>
                        <button class="cart-item-remove" onclick="event.stopPropagation(); removeFromCart(${index})"><i class="fas fa-times"></i></button>
                      </div>`;}).join("");

        const discountInput = document.querySelector(".discount-input");
        const discountPercent = discountInput
          ? parseFloat(discountInput.value) || 0
          : 0;
        const discount = subtotalValue * (discountPercent / 100);
        const afterDiscount = subtotalValue - discount;
        const tax = afterDiscount * 0.1;
        const total = afterDiscount + tax;

        if (cartCount)
          cartCount.textContent = cart.reduce(
            (sum, item) => sum + item.quantity,
            0
          );
        if (subtotal) subtotal.textContent = `${subtotalValue.toFixed(2)}`;
        if (discountAmount)
          discountAmount.textContent = `-${discount.toFixed(2)}`;
        if (taxAmount) taxAmount.textContent = `${tax.toFixed(2)}`;
        if (totalAmount) totalAmount.textContent = `${total.toFixed(2)}`;

        // At end of updateCartDisplay before closing function
        if (selectedCartIndex !== null) {
          const elSel = document.getElementById(
            "cart-item-" + selectedCartIndex
          );
          if (elSel) elSel.classList.add("selected");
        }

        const totalAmountLbp = document.getElementById("total-amount-lbp");
        if (totalAmountLbp) totalAmountLbp.textContent = `${total * 90000} LBP`;
      }

      function updateQuantity(index, newQuantity) {
        if (newQuantity <= 0) {
          removeFromCart(index);
        } else {
          cart[index].quantity = newQuantity;
          updateCartDisplay();
        }
      }

      function removeFromCart(index) {
        cart.splice(index, 1);
        if (selectedCartIndex === index) {
          selectedCartIndex = null;
          keypadBuffer = "";
        }
        updateCartDisplay();
      }

      function clearCart() {
        if (
          cart.length > 0 &&
          confirm("Are you sure you want to clear the cart?")
        ) {
          cart = [];
          updateCartDisplay();
        }
      }

      function processPayment() {
        if(cart.length===0){showToast('Cart is empty','error');return;}
        openPaymentModal();
      }

      function openDrawer() {
        alert("Drawer opened (demo)"); // Placeholder for actual drawer opening command
      }

      // Page navigation
      function showPage(pageName) {
        console.log("Navigating to:", pageName);
        currentPage = pageName;
        const pageTitle = document.getElementById("page-title");
        const pageContent = document.getElementById("page-content");
        const mobileCartToggle = document.getElementById("mobile-cart-toggle");

        // Update active nav item
        document.querySelectorAll(".nav-item").forEach((item) => {
          item.classList.remove("active");
          if (item.getAttribute("href") === `#${pageName}`) {
            item.classList.add("active");
          }
        });

        // Update page title
        const titles = {
          sale: "Point of Sale",
          "daily-sales": "Daily Sales",
          shift: "Shift Management",
          inventory: "Inventory",
          purchases: "Purchases",
          customers: "Customers",
          users: "User Management",
          settings: "Settings",
          reports: "Reports",
          dashboard: "Dashboard",
        };

        pageTitle.textContent = titles[pageName] || "Point of Sale";

        // Show/hide mobile cart toggle
        mobileCartToggle.style.display =
          pageName === "sale" && window.innerWidth <= 700 ? "flex" : "none";

        // Load page content
        let pageHTML = "";
        try {
          switch (pageName) {
            case "sale":
              pageHTML = getSalePage();
              break;
            case "daily-sales":
              pageHTML = getDailySalesPage();
              break;
            case "shift":
              pageHTML = getShiftPage();
              break;
            case "inventory":
              pageHTML = getInventoryPage();
              break;
            case "purchases":
              pageHTML = getPurchasesPage();
              break;
            case "customers":
              pageHTML = getCustomersPage();
              break;
            case "users":
              pageHTML = getUsersPage();
              break;
            case "settings":
              pageHTML = getSettingsPage();
              break;
            case "reports":
              pageHTML = getReportsPage();
              break;
            case "dashboard":
              pageHTML = getDashboardPage();
              break;
            default:
              pageHTML = getSalePage();
          }

          pageContent.innerHTML = pageHTML;

          // Update cart display if on sale page
          if (pageName === "sale") {
            updateCartDisplay();
            const imgToggle = document.getElementById("toggle-product-images");
            if (imgToggle) toggleProductImages(imgToggle);
            attachProductCardLongPress();
          } else if (pageName === "inventory") {
            initInventoryPage();
          } else if (pageName === "dashboard") {
            // Initialize dashboard charts after DOM is updated
            setTimeout(function () {
              console.log("Initializing dashboard charts after page load...");
              if (window.initDashboardCharts) {
                window.initDashboardCharts();
              } else {
                console.error("initDashboardCharts function not found!");
              }
            }, 100);
          } else if (pageName === "purchases") {
            // Show sample item automatically for demonstration
            purchaseItems.length = 0;
            if (inventoryData.length) {
              addPurchaseItem(inventoryData[0]);
            }
          } else if (pageName === "daily-sales") {
            filterDailySalesByDate(getTodayDateKey());
          } else if (pageName === "shift") {
            populateShiftPage();
          } else if (pageName === "reports") {
            if (typeof renderReportPage === "function") renderReportPage();
          }
        } catch (error) {
          console.error("Error loading page:", error);
          pageContent.innerHTML =
            '<div style="padding: 2rem; text-align: center; color: var(--danger);">Error loading page. Please refresh and try again.</div>';
        }

        // Close mobile sidebar
        document.getElementById("sidebar").classList.remove("active");
      }

      // Toggle functions
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        sidebar.classList.toggle("active");
      }

      function toggleCart() {
        const cart = document.getElementById("cart");
        if (cart) {
          cart.classList.toggle("active");
          cartOpen = !cartOpen;
        }
      }

      // Modal functions
      function openModal(modalId) {
        document.getElementById(modalId).classList.add("active");
      }

      function closeModal(modalId) {
        document.getElementById(modalId).classList.remove("active");
      }

      // Initialize
      window.addEventListener("load", () => {
        showPage("sale");
      });

      // Handle window resize
      window.addEventListener("resize", () => {
        const mobileCartToggle = document.getElementById("mobile-cart-toggle");
        if (currentPage === "sale") {
          mobileCartToggle.style.display =
            window.innerWidth <= 700 ? "flex" : "none";
        }
      });

      // Close modals on outside click
      window.addEventListener("click", (e) => {
        if (e.target.classList.contains("modal")) {
          e.target.classList.remove("active");
        }
      });

      // Handle discount input change
      document.addEventListener("input", (e) => {
        if (e.target.classList.contains("discount-input")) {
          const slider = document.querySelector(".discount-slider");
          if (slider) slider.value = e.target.value;
          updateCartDisplay();
        }
      });

      // Sync slider to input
      function updateDiscountFromSlider(val) {
        const input = document.querySelector(".discount-input");
        if (input) input.value = val;
        updateCartDisplay();
      }

      // Update slider inside changeDiscount helper
      function changeDiscount(delta) {
        const input = document.querySelector(".discount-input");
        if (!input) return;
        let val = parseInt(input.value || 0, 10);
        val = isNaN(val) ? 0 : val + delta;
        if (val < 0) val = 0;
        if (val > 100) val = 100;
        input.value = val;
        const slider = document.querySelector(".discount-slider");
        if (slider) slider.value = val;
        updateCartDisplay();
      }

      // Product view toggle
      function changeProductView(button, view) {
        const productsGrid = document.querySelector(".products-grid");
        if (!productsGrid) return;
        document
          .querySelectorAll(".view-btn")
          .forEach((btn) => btn.classList.remove("active"));
        button.classList.add("active");
        if (view === "list") {
          productsGrid.classList.add("list-view");
        } else {
          productsGrid.classList.remove("list-view");
        }
      }

      function switchToggle(btn) {
        const group = btn.parentElement;
        group
          .querySelectorAll(".toggle-btn")
          .forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
      }

      // Invoice modal populate (dummy data for now)
      function openInvoiceModal(receipt) {
        const body = document.getElementById("invoice-body");
        const title = document.getElementById("invoice-title");
        title.textContent = `invoice ${receipt.replace("#", "")}`;
        let products;
        let showDisc = false;
        if (invoiceDetailsData[receipt]) {
          products = invoiceDetailsData[receipt].items;
          showDisc = products.some((p) => p.discount && p.discount > 0);
        } else {
          products = [{ name: "Item", qty: 1, cost: 1, price: 1, discount: 0 }];
        }
        const rows = products
          .map(
            (p) =>
              `<tr><td>${p.name}</td><td>${p.qty}</td><td>${p.cost}</td><td>${
                p.price
              }</td>${
                showDisc
                  ? `<td class='invoice-discount'>${p.discount || 0}%</td>`
                  : ""
              }<td>${(p.price * (1 - (p.discount || 0) / 100) * p.qty).toFixed(
                2
              )}</td></tr>`
          )
          .join("");
        const totalUsd = products
          .reduce(
            (s, p) => s + p.price * (1 - (p.discount || 0) / 100) * p.qty,
            0
          )
          .toFixed(2);
        body.innerHTML = `<table class='invoice-table'><thead><tr><th>Product</th><th>Qty</th><th>Cost Price</th><th>Selling Price</th>${
          showDisc ? "<th>Discount %</th>" : ""
        }<th>Total</th></tr></thead><tbody>${rows}</tbody></table><div class='invoice-total'>TOTAL : ${totalUsd} USD</div>`;
        openModal("invoice-modal");
      }

      /* ---------------- Purchases & Suppliers Logic ---------------- */
      const purchaseItems = [];
      const suppliers = [{ name: "Default Supplier" }];

      function handlePurchaseSearch(e) {
        if (e.key === "Enter") {
          const term = e.target.value.trim().toLowerCase();
          if (!term) return;
          const product = inventoryData.find(
            (p) =>
              p.name.toLowerCase().includes(term) || p.barcode.includes(term)
          );
          if (product) {
            addPurchaseItem(product);
            e.target.value = "";
          } else {
            alert("Product not found");
          }
        }
      }

      function addPurchaseItem(prod) {
        const existing = purchaseItems.find((i) => i.barcode === prod.barcode);
        if (existing) {
          existing.qty += 1;
        } else {
          purchaseItems.push({
            ...prod,
            profitRate: 0,
            sellingPrice: prod.price,
            qty: 1,
          });
        }
        renderPurchaseItems();
      }

      function removePurchaseItem(idx) {
        purchaseItems.splice(idx, 1);
        renderPurchaseItems();
      }

      function updatePurchaseField(idx, field, value) {
        purchaseItems[idx][field] = parseFloat(value) || 0;
        renderPurchaseItems();
      }

      function renderPurchaseItems() {
        const container = document.getElementById("purchase-items-container");
        if (!container) return;

        if (purchaseItems.length === 0) {
          container.innerHTML = `<div style="padding:1rem;color:var(--gray-500);">No items added</div>`;
          updatePurchaseTotals();
          return;
        }

        container.innerHTML = purchaseItems
          .map(
            (item, idx) => `
            <div class="purchase-item">
              <span class="purchase-name">${idx + 1}) ${
              item.name
            }<span class="old-details"> (old qty :0.0 - old cost :${item.cost.toFixed(
              3
            )} USD)</span>
                <button class="icon-btn history" onclick="openItemHistory(${idx},'table')"><i class="fas fa-table"></i></button>
                <button class="icon-btn chart" onclick="openItemHistory(${idx},'chart')"><i class="fas fa-chart-line"></i></button>
              </span>
              <div class="field-group" style="min-width:110px;">
                <label class="field-label">Cost Price</label>
                <input type="number" class="form-input" value="${
                  item.cost
                }" oninput="updatePurchaseField(${idx}, 'cost', this.value)" />
              </div>
              <div class="field-group" style="max-width:80px;">
                <label class="field-label">Profit %</label>
                <input type="number" class="form-input" value="${
                  item.profitRate
                }" oninput="updatePurchaseField(${idx}, 'profitRate', this.value)" />
              </div>
              <div class="field-group" style="min-width:200px;">
                <label class="field-label">Selling Price</label>
                <div style="display:flex;gap:4px;align-items:center;">
                  <input type="number" class="form-input" value="${
                    item.sellingPrice
                  }" oninput="updatePurchaseField(${idx}, 'sellingPrice', this.value)" style="flex:1;" />
                  <div class="currency-toggle">
                    <button type="button" class="toggle-btn active" onclick="switchToggle(this)">USD</button>
                    <button type="button" class="toggle-btn" onclick="switchToggle(this)">LBP</button>
                  </div>
                </div>
              </div>
              <div class="field-group" style="max-width:80px;">
                <label class="field-label">Qty</label>
                <input type="number" class="form-input" value="${
                  item.qty
                }" oninput="updatePurchaseField(${idx}, 'qty', this.value)" />
              </div>
              <button class="btn btn-danger btn-icon" onclick="removePurchaseItem(${idx})"><i class="fas fa-trash"></i></button>
              <div class="purchase-hints" style="grid-column:1 / -1; font-size:0.75rem; color:var(--danger);">new avg cost : ${item.cost.toFixed(
                3
              )} (Saved to Stock) &nbsp;|&nbsp; Selling Price => ${(
              item.sellingPrice * 90000
            ).toLocaleString()} LBP</div>
            </div>
          `
          )
          .join("");

        updatePurchaseTotals();
      }

      function updatePurchaseTotals() {
        const totalQty = purchaseItems.reduce((s, i) => s + (i.qty || 0), 0);
        const totalUsd = purchaseItems.reduce((s, i) => s + i.cost * i.qty, 0);
        document.getElementById("purchase-total-qty").textContent =
          totalQty.toFixed(1);
        document.getElementById("purchase-total-usd").textContent =
          totalUsd.toFixed(2) + " USD";
        document.getElementById("purchase-total-lbp").textContent =
          (totalUsd * 90000).toLocaleString() + " LBP";
      }

      function savePurchase() {
        if (purchaseItems.length === 0) {
          alert("No items to save");
          return;
        }
        alert("Purchase saved (demo)");
        // reset
        purchaseItems.length = 0;
        renderPurchaseItems();
      }

      /* ------------- Supplier helpers ------------- */
      function openSupplierModal() {
        renderSupplierList();
        openModal("supplier-modal");
      }

      function renderSupplierList() {
        const term = (
          document.getElementById("supplier-search").value || ""
        ).toLowerCase();
        const body = document.getElementById("supplier-table-body");
        if (!body) return;
        const rows =
          suppliers
            .filter((s) => s.name.toLowerCase().includes(term))
            .map(
              (s, i) => `
              <tr>
                <td>${s.name}</td>
                <td>
                  <button class="btn btn-secondary btn-icon" onclick="editSupplier(${i})"><i class="fas fa-edit"></i></button>
                  <button class="btn btn-danger btn-icon" onclick="deleteSupplier(${i})"><i class="fas fa-trash"></i></button>
                </td>
              </tr>`
            )
            .join("") ||
          `<tr><td colspan="2" style="text-align:center;padding:1rem;color:var(--gray-500);">No suppliers found</td></tr>`;
        body.innerHTML = rows;
      }

      function openAddSupplierForm() {
        const name = prompt("Supplier Name:");
        if (name) {
          suppliers.push({ name });
          renderSupplierList();
        }
      }

      function editSupplier(idx) {
        const name = prompt("Edit Supplier Name:", suppliers[idx].name);
        if (name) {
          suppliers[idx].name = name;
          renderSupplierList();
        }
      }

      function deleteSupplier(idx) {
        if (confirm("Delete supplier?")) {
          suppliers.splice(idx, 1);
          renderSupplierList();
        }
      }
      /* ------------------------------------------------------------ */

      /* ------------ Item History Modal ------------ */
      let currentHistoryIdx = null;
      function openItemHistory(idx, defaultTab = "table") {
        currentHistoryIdx = idx;
        const prod = purchaseItems[idx] ||
          inventoryData[idx] || { name: "Product" };
        document.getElementById(
          "history-title"
        ).textContent = `History - ${prod.name}`;
        // reset toggle states
        document
          .querySelectorAll("#history-tab-toggle .toggle-btn")
          .forEach((btn) => btn.classList.remove("active"));
        if (defaultTab === "chart") {
          document
            .querySelector("#history-tab-toggle .toggle-btn:nth-child(2)")
            .classList.add("active");
        } else {
          document
            .querySelector("#history-tab-toggle .toggle-btn:nth-child(1)")
            .classList.add("active");
        }
        switchHistoryTab(defaultTab);
        openModal("item-history-modal");
      }

      function switchHistoryTab(type) {
        const body = document.getElementById("history-body");
        if (!body) return;
        if (type === "table") {
          body.innerHTML = `<table class="table" style="margin-top:0.5rem;">
              <thead><tr><th>Date</th><th>Qty</th><th>Cost</th><th>Price</th></tr></thead>
              <tbody>
                <tr><td>10-07-2025</td><td>12</td><td>$3.50</td><td>$6.00</td></tr>
                <tr><td>09-07-2025</td><td>8</td><td>$3.45</td><td>$6.00</td></tr>
                <tr><td>08-07-2025</td><td>15</td><td>$3.40</td><td>$6.00</td></tr>
              </tbody>
            </table>`;
        } else {
          body.innerHTML = `<div style="height:300px;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--gray-400);">
              <i class="fas fa-chart-line" style="font-size:3rem;"></i>
              <p>Chart preview coming soon...</p>
            </div>`;
        }
        // update toggle active state
        document
          .querySelectorAll("#history-tab-toggle .toggle-btn")
          .forEach((btn) => btn.classList.remove("active"));
        if (type === "chart") {
          document
            .querySelector("#history-tab-toggle .toggle-btn:nth-child(2)")
            .classList.add("active");
        } else {
          document
            .querySelector("#history-tab-toggle .toggle-btn:nth-child(1)")
            .classList.add("active");
        }
      }
      /* -------------------------------------------- */

      // Toggle product images
      function toggleProductImages(checkbox) {
        const grid = document.querySelector(".products-grid");
        if (!grid) return;
        if (checkbox.checked) {
          grid.classList.remove("hide-images");
        } else {
          grid.classList.add("hide-images");
        }
      }

      // Hold orders stack
      const onHoldOrders = [];

      function placeOnHold() {
        if (cart.length === 0) {
          alert("No items in cart to place on hold");
          return;
        }
        onHoldOrders.push(JSON.parse(JSON.stringify(cart)));
        cart = [];
        updateCartDisplay();
        alert("Order placed on hold");
      }

      function viewOnHold() {
        if (onHoldOrders.length === 0) {
          alert("No held orders");
          return;
        }
        cart = onHoldOrders.pop();
        updateCartDisplay();
      }

      // --- KEYPAD & SELECTION LOGIC ---
      let selectedCartIndex = null;
      let keypadBuffer = "";
      function selectCartItem(idx) {
        selectedCartIndex = idx;
        keypadBuffer = "";
        document
          .querySelectorAll(".cart-item")
          .forEach((el) => el.classList.remove("selected"));
        const el = document.getElementById("cart-item-" + idx);
        if (el) el.classList.add("selected");
        // Sync discount controls with selected item's discount
        const disc = (cart[idx] && cart[idx].discount) || 0;
        const discInput = document.querySelector(".discount-input");
        if (discInput) discInput.value = disc;
        const discSlider = document.querySelector(".discount-slider");
        if (discSlider) discSlider.value = disc;
      }
      function applyKeypadQty() {
        if (selectedCartIndex === null) return;
        const qty = keypadBuffer === "" ? 1 : parseInt(keypadBuffer, 10);
        updateQuantity(selectedCartIndex, qty);
      }
      function keypadAppend(digit) {
        if (selectedCartIndex === null) {
          alert("Select an item");
          return;
        }
        if (keypadBuffer === "0") keypadBuffer = "";
        keypadBuffer += String(digit);
        applyKeypadQty();
      }
      function keypadDelete() {
        if (selectedCartIndex === null) return;
        keypadBuffer = keypadBuffer.slice(0, -1);
        applyKeypadQty();
      }
      function keypadClear() {
        if (selectedCartIndex === null) return;
        keypadBuffer = "";
        applyKeypadQty();
      }

      // ---------- Invoice from cart ----------
      function openInvoiceFromCart() {
        if (cart.length === 0) {
          alert("Cart is empty!");
          return;
        }
        const body = document.getElementById("invoice-body");
        const title = document.getElementById("invoice-title");
        const receiptId = Math.floor(Date.now() / 1000);
        title.textContent = `invoice ${receiptId}`;

        const rows = cart
          .map(
            (item) =>
              `<tr><td>${item.name}</td><td>${item.quantity.toFixed(
                1
              )}</td><td>${item.price.toFixed(3)}</td><td>${item.price.toFixed(
                1
              )}</td><td>${(item.price * item.quantity).toFixed(1)}</td></tr>`
          )
          .join("");

        const totalUsd = cart
          .reduce((s, it) => s + it.price * it.quantity, 0)
          .toFixed(1);
        const totalLbp = (totalUsd * 90000).toLocaleString();

        body.innerHTML = `<table class='invoice-table'>
                <thead><tr><th>Product</th><th>Qty</th><th>Cost Price</th><th>Selling Price</th><th>TOTAL</th></tr></thead>
                <tbody>${rows}</tbody></table>
                <div class='invoice-total'>TOTAL : ${totalUsd} USD<br>TOTAL : ${totalLbp} LBP</div>`;
        openModal("invoice-modal");
      }

      // ---------------- End Inventory helpers ----------------
      // Daily Sales: dummy dataset & helper functions
      const dailySalesData = {
        "2024-09-01": [
          {
            id: "#1-1",
            time: "01-09-2024 9:38 PM",
            usd: 749.33,
            lbp: 67439700,
            paymentType: "cash",
            items: [
              { name: "Chilly chicken", qty: 4.0, cost: 2.992, price: 4.5 },
              { name: "soft drink", qty: 30.0, cost: 0.6, price: 0.8 },
              { name: "Fries box", qty: 15.0, cost: 0.487, price: 2.23 },
              { name: "Chicken sub Sand", qty: 12.0, cost: 2.995, price: 4.5 },
            ],
          },
        ],
      };
      // Ensure today also has dummy data
      if (!dailySalesData[getTodayDateKey()]) {
        dailySalesData[getTodayDateKey()] = JSON.parse(
          JSON.stringify(dailySalesData["2024-09-01"])
        );
      }
      function getTodayDateKey() {
        return new Date().toISOString().slice(0, 10);
      }
      let dailySalesSelectedDate = getTodayDateKey();
      let dailySalesSearchTerm = "";

      function renderDailySales(dateKey = getTodayDateKey(), search = "") {
        dailySalesSelectedDate = dateKey;
        const tbody = document.getElementById("daily-sales-tbody");
        if (!tbody) return;
        let receipts = dailySalesData[dateKey] || [];
        if (search) {
          const term = search.toLowerCase();
          receipts = receipts.filter((r) => r.id.toLowerCase().includes(term));
        }
        if (receipts.length === 0) {
          tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:3rem; color:var(--gray-500);">No transactions found</td></tr>`;
          return;
        }
        tbody.innerHTML = receipts
          .map(
            (r) => `
            <tr>
              <td>${r.id}</td>
              <td>${r.time}</td>
              <td>${r.usd.toFixed(2)}</td>
              <td>${r.lbp.toLocaleString()}</td>
              <td><span class="badge badge-success">${r.paymentType}</span></td>
              <td>
                <button class="btn btn-secondary btn-icon" title="Details" onclick="openInvoiceFromDailySale('${dateKey}','${
              r.id
            }')\"><i class="fas fa-eye"></i></button>
                <button class="btn btn-danger btn-icon" title="Refund" onclick="openRefundModal('${dateKey}','${
              r.id
            }')\"><i class="fas fa-undo-alt"></i></button>
                <button class="btn btn-danger btn-icon" title="Delete" onclick="deleteReceipt('${dateKey}','${
              r.id
            }')\"><i class="fas fa-trash"></i></button>
              </td>
            </tr>`
          )
          .join("");
      }
      function filterDailySalesByDate(dateStr) {
        dailySalesSelectedDate = dateStr || getTodayDateKey();
        renderDailySales(dailySalesSelectedDate, dailySalesSearchTerm);
      }
      function filterDailySalesBySearch(term) {
        dailySalesSearchTerm = term || "";
        renderDailySales(dailySalesSelectedDate, dailySalesSearchTerm);
      }
      function toggleDailyStats() {
        const section = document.getElementById("daily-stats-section") || document.querySelector(".stats-grid");
        if (!section) return;
        const hidden = section.style.display === "none";
        section.style.display = hidden ? "" : "none";
        const icon = document.querySelector("#daily-stats-toggle i");
        if (icon) {
          icon.className = hidden ? "fas fa-chart-bar" : "fas fa-chart-line";
        }
      }
      function openInvoiceFromDailySale(dateKey, receiptId) {
        const receipt = (dailySalesData[dateKey] || []).find(
          (r) => r.id === receiptId
        );
        if (!receipt) return;
        const body = document.getElementById("invoice-body");
        const title = document.getElementById("invoice-title");
        title.textContent = `invoice ${receiptId.replace("#", "")}`;
        const showDisc = receipt.items.some(
          (it) => it.discount && it.discount > 0
        );
        const rows = receipt.items
          .map(
            (i) =>
              `<tr><td>${i.name}</td><td>${i.qty}</td><td>${i.cost}</td><td>${
                i.price
              }</td>${
                showDisc
                  ? `<td class='invoice-discount'>${i.discount || 0}%</td>`
                  : ""
              }<td>${(i.price * (1 - (i.discount || 0) / 100) * i.qty).toFixed(
                2
              )}</td></tr>`
          ) // corrected total
          .join("");
        body.innerHTML = `<table class='invoice-table'><thead><tr><th>Product</th><th>Qty</th><th>Cost Price</th><th>Selling Price</th>${
          showDisc ? `<th>Discount %</th>` : ""
        }<th>Total</th></tr></thead><tbody>${rows}</tbody></table><div class='invoice-total'>TOTAL : ${receipt.usd.toFixed(
          2
        )} USD</div>`;
        openModal("invoice-modal");
      }
      function openRefundModal(dateKey, receiptId) {
        const receipt = (dailySalesData[dateKey] || []).find(
          (r) => r.id === receiptId
        );
        if (!receipt) return;
        const body = document.getElementById("refund-body");
        const title = document.getElementById("refund-title");
        title.textContent = `Refund - ${receiptId}`;
        body.innerHTML = `<table class='table'><thead><tr><th></th><th>Name</th><th>Qty</th><th>Price</th><th>Total Price</th><th>Reason</th></tr></thead><tbody>${receipt.items
          .map(
            (i, idx) =>
              `<tr>
                 <td><input type='checkbox' onchange="this.closest('tr').querySelector('.refund-reason').style.display = this.checked ? '' : 'none';"></td>
                 <td>${i.name}</td>
                 <td>${i.qty}</td>
                 <td>${i.price}</td>
                 <td>${(i.qty * i.price).toFixed(2)}</td>
                 <td><input type='text' class='form-input refund-reason' placeholder='Reason...' style='display:none;max-width:140px;'></td>
               </tr>`
          )
          .join("")}</tbody></table><div style='text-align:right;margin-top:1rem;font-weight:700;'>TOTAL REFUND: ${receipt.usd.toFixed(
          2
        )} USD</div>`;
        openModal("refund-modal");
      }
      function processRefund() {
        alert("Refund processed (demo)");
        closeModal("refund-modal");
      }
      // ---------------- End Daily Sales helpers ----------------

      function deleteReceipt(dateKey, id) {
        if (!confirm("Delete receipt " + id + "?")) return;
        if (!dailySalesData[dateKey]) return;
        dailySalesData[dateKey] = dailySalesData[dateKey].filter(
          (r) => r.id !== id
        );
        renderDailySales(dailySalesSelectedDate, dailySalesSearchTerm);
      }

      // ---------------- Shift helpers ----------------
      const shiftData = [
        {
          id: 267,
          start: "11-07-2025 06:23 PM",
          end: null,
          label: "shift : 267  -  11-07-2025 06:23 PM",
          receipts: [
            {
              id: "#1-20001",
              time: "11-07-2025 7:00 PM",
              usd: 50.0,
              lbp: 4500000,
              paymentType: "cash",
            },
            {
              id: "#1-20002",
              time: "11-07-2025 7:05 PM",
              usd: 30.0,
              lbp: 2700000,
              paymentType: "cash",
            },
            {
              id: "#1-20003",
              time: "11-07-2025 7:10 PM",
              usd: 15.0,
              lbp: 1350000,
              paymentType: "cash",
            },
            {
              id: "#1-20004",
              time: "11-07-2025 7:15 PM",
              usd: 12.0,
              lbp: 1080000,
              paymentType: "cash",
            },
            {
              id: "#1-20005",
              time: "11-07-2025 7:20 PM",
              usd: 20.0,
              lbp: 1800000,
              paymentType: "cash",
            },
          ],
        },
        {
          id: 266,
          start: "14-05-2025 11:55 PM",
          end: "11-07-2025 06:23 PM",
          label: "shift : 266  -  14-05-2025 11:55 PM",
          receipts: [
            {
              id: "#1-10710",
              time: "10-06-2025 5:27 PM",
              usd: 1.76,
              lbp: 158_400,
              paymentType: "cash",
            },
            {
              id: "#1-10709",
              time: "10-06-2025 5:27 PM",
              usd: 0,
              lbp: 0,
              paymentType: "cash",
            },
          ],
        },
      ];
      let selectedShiftIndex = 0;

      function shiftSummary(shift) {
        const salesUsd = shift.receipts.reduce((s, r) => s + r.usd, 0);
        const salesLbp = shift.receipts.reduce((s, r) => s + r.lbp, 0);
        return { salesUsd, salesLbp };
      }

      function generateShiftPage() {
        const shift = shiftData[selectedShiftIndex];
        const sum = shiftSummary(shift);
        const rows = shift.receipts
          .map(
            (r) =>
              `<tr><td>${r.id}</td><td>${r.time}</td><td>${r.usd.toFixed(
                2
              )}</td><td>${r.lbp.toLocaleString()}</td><td><span class='badge badge-success'>${
                r.paymentType
              }</span></td><td><button class='btn btn-secondary btn-icon' onclick=\"openInvoiceModal('${
                r.id
              }')\"><i class='fas fa-eye'></i></button></td></tr>`
          )
          .join("");
        return `
        <div class="table-container">
          <div class="table-header">
            <h2 class="table-title">Shift Management</h2>
            <button class="btn btn-primary"><i class="fas fa-sign-out-alt"></i> End Shift</button>
          </div>
          <div style="padding:1.5rem;">
            <div style="display:flex;flex-direction:column;gap:0.5rem;margin-bottom:1rem;">
              <div class="shift-info-card"><i class="fas fa-clock"></i> <span>Current Shift :</span> <span class="shift-number">#${
                shiftData[0].id
              }</span> <span class="shift-time">- ${
          shiftData[0].start
        }  now</span></div>
              <div class="shift-info-card"><i class="fas fa-check-circle"></i> <span>Selected Shift :</span> <span class="shift-number">#${
                shift.id
              }</span> <span class="shift-time">- ${shift.start}${
          shift.end ? `  ${shift.end}` : "  now"
        }</span> <button class="btn btn-secondary btn-sm" style="margin-left:0.5rem;" onclick="openShiftSelector()">Open latest Shifts</button></div>
            </div>
            <div class="shift-summary" style="border:1px solid var(--danger);padding:1rem 1.25rem;border-radius:12px;max-width:380px;color:var(--danger);margin-bottom:1rem;">
              <div class="summary-row"><span class="summary-label">Sales :</span> <span>${sum.salesUsd.toFixed(
                2
              )} USD | ${sum.salesLbp.toLocaleString()} LBP</span></div>
              <div class="cash-box" style="border:1px solid var(--gray-300);border-radius:8px;padding:0.5rem;margin-top:0.5rem;font-size:0.75rem;text-align:center;color:var(--gray-700);">from cash : ${sum.salesUsd.toFixed(
                2
              )} USD</div>
            </div>
            <div class="table-wrapper">
              <table class="table"><thead><tr><th>Receipt No.</th><th>Time</th><th>Amount (USD)</th><th>Amount (LBP)</th><th>Payment Type</th><th>Actions</th></tr></thead><tbody>${rows}</tbody></table>
            </div>
          </div>
        </div>`;
      }

      function openShiftSelector() {
        const body = document.getElementById("shift-list-body");
        if (!body) return;
        body.innerHTML = shiftData
          .map(
            (s, i) =>
              `<div style="padding:0.5rem 0.75rem;cursor:pointer;border-radius:6px;margin-bottom:4px;${
                i === selectedShiftIndex
                  ? "background:var(--primary-light);color:var(--primary);"
                  : ""
              }" onclick="selectShift(${i})">${s.label}</div>`
          )
          .join("");
        openModal("shift-select-modal");
      }

      function selectShift(idx) {
        selectedShiftIndex = idx;
        closeModal("shift-select-modal");
        showPage("shift");
      }
      // ---------------- End Shift helpers ----------------

      function populateShiftPage() {
        const current = shiftData[0];
        const sel = shiftData[selectedShiftIndex];
        // Update info cards
        const curNum = document.getElementById("shift-current-number");
        const curTime = document.getElementById("shift-current-time");
        if (curNum) curNum.textContent = "#" + current.id;
        if (curTime) curTime.textContent = `- ${current.start}  now`;
        const selNum = document.getElementById("selected-shift-number");
        const selTime = document.getElementById("selected-shift-time");
        if (selNum) selNum.textContent = "#" + sel.id;
        if (selTime)
          selTime.textContent = `- ${sel.start}${
            sel.end ? `  ${sel.end}` : "  now"
          }`;
        // Summary
        const sum = shiftSummary(sel);
        const salesEl = document.getElementById("shift-sales-values");
        if (salesEl)
          salesEl.textContent = `${sum.salesUsd.toFixed(
            2
          )} USD | ${sum.salesLbp.toLocaleString()} LBP`;
        // Receipts table
        const tbody = document.getElementById("shift-receipts-body");
        if (tbody) {
          if (sel.receipts.length === 0) {
            tbody.innerHTML =
              '<tr><td colspan="6" style="text-align:center;padding:1rem;color:var(--gray-500);">No receipts</td></tr>';
          } else {
            tbody.innerHTML = sel.receipts
              .map((r) => {
                const hasDisc = invoiceDetailsData[r.id]?.items?.some(
                  (it) => it.discount && it.discount > 0
                );
                return `<tr class='${hasDisc ? "discounted-row" : ""}'><td>${
                  r.id
                }</td><td>${r.time}</td><td>${r.usd.toFixed(
                  2
                )}</td><td>${r.lbp.toLocaleString()}</td><td><span class='badge badge-success'>${
                  r.paymentType
                }</span></td><td><button class='btn btn-secondary btn-icon' onclick=\"openInvoiceModal('${
                  r.id
                }')\"><i class='fas fa-eye'></i></button></td></tr>`;
              })
              .join("");
          }
        }
      }

      // -------- JS additions (after shift helpers end comment) --------
      // Extra invoice details with discounts
      const invoiceDetailsData = {
        "#1-10709": {
          items: [
            {
              name: "Special Beef Burger",
              qty: 1,
              cost: 2.5,
              price: 7,
              discount: 20,
            },
            { name: "Fries box", qty: 1, cost: 0.5, price: 2, discount: 0 },
          ],
        },
        "#1-20002": {
          items: [
            { name: "Chilly chicken", qty: 2, cost: 3, price: 5, discount: 15 },
            { name: "soft drink", qty: 1, cost: 0.5, price: 1, discount: 0 },
          ],
        },
        "#1-20005": {
          items: [
            {
              name: "Special Beef Burger",
              qty: 1,
              cost: 2.5,
              price: 7,
              discount: 25,
            },
            { name: "Fries box", qty: 2, cost: 0.5, price: 2, discount: 0 },
          ],
        },
      };

      function toggleShiftBalance() {
        const s = document.querySelector(".shift-summary");
        const btn = document.getElementById("balance-toggle-inside");
        if (!s) return;
        const hidden = s.style.display === "none";
        s.style.display = hidden ? "" : "none";
        if (btn) btn.textContent = hidden ? "Hide Balance" : "Show Balance";
      }

      // --------- EXTRA INVENTORY ACTIONS ---------
      function downloadExcel(code) {
        alert("Download Excel for product " + code + " (demo)");
      }
      function openInventoryHistory(barcode, defaultTab = "table") {
        const prod = inventoryData.find((p) => p.barcode === barcode) || {
          name: "Product",
        };
        document.getElementById(
          "history-title"
        ).textContent = `History - ${prod.name}`;
        // reset toggle state
        document
          .querySelectorAll("#history-tab-toggle .toggle-btn")
          .forEach((btn) => btn.classList.remove("active"));
        if (defaultTab === "chart") {
          document
            .querySelector("#history-tab-toggle .toggle-btn:nth-child(2)")
            .classList.add("active");
        } else {
          document
            .querySelector("#history-tab-toggle .toggle-btn:nth-child(1)")
            .classList.add("active");
        }
        switchHistoryTab(defaultTab);
        openModal("item-history-modal");
      }
      // --------- END EXTRA INVENTORY ACTIONS ---------

      // Update download button label based on selected category
      function updateDownloadButtonLabel() {
        const btn = document.getElementById("download-stock-btn");
        const sel = document.getElementById("inventory-category-filter");
        if (!btn || !sel) return;
        const allSelected = !sel.value || sel.value === "All";
        btn.innerHTML = `<i class="fas fa-download"></i> ${
          allSelected ? "Download All Stock" : "Download Stock by Category"
        }`;
      }

      // Placeholder for actual export functionality
      function downloadInventoryStock() {
        const sel = document.getElementById("inventory-category-filter");
        const category = sel ? sel.value : "All";
        alert(
          `Downloading ${
            category === "All" ? "all stock" : "stock for category: " + category
          } (demo)`
        );
      }

      // Import inventory data stub
      function importInventoryData() {
        const fileInput = document.getElementById("inventory-import-file");
        if (!fileInput || !fileInput.files.length) {
          alert("Please choose a file");
          return;
        }
        const file = fileInput.files[0];
        alert(`Importing data from ${file.name} (demo)`);
        // TODO: parse & upload logic
        closeModal("import-data-modal");
      }

      // ---------- CUSTOMER DETAILS ----------
      function openCustomerDetails(name) {
        // dummy invoices data
        const invoices = [
          { id: "#1234", time: "10-07-2025 4:12 PM", usd: 45.7, lbp: 4113000 },
          { id: "#1235", time: "08-07-2025 1:55 PM", usd: 32.1, lbp: 2889000 },
          { id: "#1236", time: "05-07-2025 9:30 PM", usd: 12.0, lbp: 1080000 },
          { id: "#1237", time: "02-07-2025 8:02 PM", usd: 60.5, lbp: 5445000 },
        ];
        // dummy items data
        const topItems = [
          { name: "Burger", qty: 15 },
          { name: "Fries", qty: 12 },
          { name: "Soft Drink", qty: 30 },
        ];
        const tbody = document.getElementById("customer-invoices-body");
        tbody.innerHTML = invoices
          .map(
            (r) =>
              `<tr><td>${r.id}</td><td>${r.time}</td><td>${r.usd.toFixed(
                2
              )}</td><td>${r.lbp.toLocaleString()}</td></tr>`
          )
          .join("");
        const itemsBody = document.getElementById("customer-top-items-body");
        itemsBody.innerHTML = topItems
          .map((it) => `<tr><td>${it.name}</td><td>${it.qty}</td></tr>`)
          .join("");
        document.getElementById("customer-details-title").textContent =
          name.toLowerCase();
        // draw pie chart
        if (window.Chart) {
          const pieCtx = document
            .getElementById("customer-pie")
            .getContext("2d");
          if (window.customerPieChart) customerPieChart.destroy();
          window.customerPieChart = new Chart(pieCtx, {
            type: "pie",
            data: {
              labels: ["Total Revenue", "Total Profit"],
              datasets: [
                { data: [150, 45], backgroundColor: ["#f59e0b", "#3b82f6"] },
              ],
            },
            options: { plugins: { legend: { position: "right" } } },
          });
        }
        openModal("customer-details-modal");
      }
      // ---------- END CUSTOMER DETAILS ----------

      // ---------- USERS MANAGEMENT ----------
      function addUser() {
        const name = document.getElementById("new-user-name").value.trim();
        const email = document.getElementById("new-user-email").value.trim();
        const role = document.getElementById("new-user-role").value;
        const status = document.getElementById("new-user-status").value;
        if (!name || !email) return alert("Please fill all fields");
        const tbody = document.getElementById("users-table-body");
        const row = `<tr>
          <td><div style="display:flex; align-items:center; gap:0.75rem;"><div class="user-avatar" style="width:32px;height:32px;font-size:0.875rem;">${name
            .slice(0, 2)
            .toUpperCase()}</div><div><div style="font-weight:600;">${name}</div><div style="font-size:0.75rem; color:var(--gray-500);">${role}</div></div></div></td>
          <td>${email}</td>
          <td><span class="badge badge-primary">${role}</span></td>
          <td><span class="badge ${
            status === "Active" ? "badge-success" : "badge-danger"
          }">${status}</span></td>
          <td>Just now</td>
          <td><button class="btn btn-secondary btn-icon"><i class="fas fa-edit"></i></button></td>
        </tr>`;
        tbody.insertAdjacentHTML("afterbegin", row);
        closeModal("add-user-modal");
        document.getElementById("add-user-form").reset();
      }
      // ---------- END USERS MANAGEMENT ----------

      // ---------- CURRENCY SELECTOR ----------
      const currencyOptions = ["LBP", "USD", "EGP", "ILS", "SAR", "SYP", "QAR"];
      let currentCurrencyTarget = "primary";
      function openCurrencySelector(target) {
        currentCurrencyTarget = target;
        const title = document.getElementById("currency-modal-title");
        title.textContent =
          target === "primary" ? "Primary Currency" : "Secondary Currency";
        const body = document.getElementById("currency-list-body");
        const currentBtn = document.getElementById(
          target === "primary"
            ? "primary-currency-btn"
            : "secondary-currency-btn"
        );
        const currentVal = currentBtn.textContent.trim().split(" ")[0];
        body.innerHTML = currencyOptions
          .map(
            (c) =>
              `<div onclick="selectCurrency('${c}')" style="padding:0.75rem 1rem; cursor:pointer; display:flex; justify-content:space-between; align-items:center; ${
                c === currentVal ? "background:var(--gray-200);" : ""
              }">${c}${
                c === currentVal
                  ? "<i class='fas fa-check' style='color:var(--primary);'></i>"
                  : ""
              }</div>`
          )
          .join("");
        openModal("currency-select-modal");
      }
      function selectCurrency(code) {
        const btnId =
          currentCurrencyTarget === "primary"
            ? "primary-currency-btn"
            : "secondary-currency-btn";
        const btn = document.getElementById(btnId);
        if (btn) {
          btn.innerHTML = `${code} <i class='fas fa-chevron-right'></i>`;
        }
        closeModal("currency-select-modal");
      }
      // ---------- END CURRENCY SELECTOR ----------

      // ---------- REPORT PAGE LOGIC ----------
      function switchReportTab(idx) {
        document
          .querySelectorAll(".rep-tab-link")
          .forEach((l, i) => l.classList.toggle("active", i === idx));
        document.querySelectorAll(".rep-tab-content").forEach((c, i) => {
          c.style.display = i === idx ? "" : "none";
        });
        if (idx === 3) renderReportCharts();
      }
      // dummy data generators
      function renderReportPage() {
        renderSalesTab();
        renderSalesCatTab();
        renderExpensesTab();
        renderReportCharts();
      }
      function renderSalesTab() {
        const target = document.getElementById("rep-tab-0");
        const rows = [
          { name: "delivery", qty: 2280, cost: 0, sell: 249.7, profit: 249.7 },
          {
            name: "soft drink",
            qty: 239,
            cost: 150.57,
            sell: 257.4,
            profit: 106.83,
          },
          {
            name: "Fahita Sand",
            qty: 145,
            cost: 395.56,
            sell: 800.64,
            profit: 405.08,
          },
          {
            name: "Fries box",
            qty: 84,
            cost: 53.676,
            sell: 178.4,
            profit: 124.724,
          },
          {
            name: "Chicken & Fries",
            qty: 77,
            cost: 270.809,
            sell: 539,
            profit: 268.191,
          },
          {
            name: "Chicken Honey Mustard",
            qty: 72,
            cost: 151.92,
            sell: 432,
            profit: 280.08,
          },
          {
            name: "Chicken sub Sand",
            qty: 68,
            cost: 170.58,
            sell: 378.08,
            profit: 207.5,
          },
          {
            name: "Special chicken burger",
            qty: 67,
            cost: 162.006,
            sell: 416,
            profit: 253.994,
          },
        ];
        target.innerHTML = `<table class="table"><thead><tr><th>Product</th><th>Qty</th><th>Cost Price</th><th>Selling Price</th><th>Profit</th></tr></thead><tbody>${rows
          .map(
            (r) =>
              `<tr><td>${r.name}</td><td>${r.qty}</td><td>${r.cost}</td><td>${r.sell}</td><td>${r.profit}</td></tr>`
          )
          .join("")}</tbody></table>`;
        // append totals summary
        const totalCost = rows.reduce((s, r) => s + r.cost, 0).toFixed(2);
        const totalSell = rows.reduce((s, r) => s + r.sell, 0).toFixed(2);
        const totalProfit = rows.reduce((s, r) => s + r.profit, 0).toFixed(2);
        target.innerHTML +=
          `<div style="margin-top:0.5rem; background:var(--success); color:#fff; padding:0.5rem 1rem; border-radius:8px; display:flex; gap:1.5rem; flex-wrap:wrap; font-weight:700;">` +
          `<span>Total Cost : ${totalCost}</span>` +
          `<span>Total Revenue : ${totalSell}</span>` +
          `<span>Total Profit : ${totalProfit}</span>` +
          `</div>`;
      }
      function renderSalesCatTab() {
        const target = document.getElementById("rep-tab-1");
        const rows = [
          {
            cat: "Sandwiches",
            cost: 1070.117,
            sell: 2472.95,
            profit: 1402.833,
            perc: "31.3",
          },
          {
            cat: "Fried Chicken Burger",
            cost: 782.938,
            sell: 2127,
            profit: 1344.062,
            perc: "30.0",
          },
          {
            cat: "Cheesy Fries",
            cost: 345.441,
            sell: 748,
            profit: 402.559,
            perc: "9.0",
          },
          {
            cat: "Beef Burger",
            cost: 240.732,
            sell: 634.3,
            profit: 393.568,
            perc: "8.8",
          },
          {
            cat: "Appetisers",
            cost: 127.265,
            sell: 386.78,
            profit: 259.515,
            perc: "5.8",
          },
          { cat: "Delivery", cost: 0, sell: 249.7, profit: 249.7, perc: "5.6" },
          {
            cat: "Meals",
            cost: 91.603,
            sell: 292,
            profit: 200.397,
            perc: "4.5",
          },
          {
            cat: "Beverage",
            cost: 156.52,
            sell: 276.95,
            profit: 120.43,
            perc: "2.7",
          },
          {
            cat: "Adds",
            cost: 30.525,
            sell: 91.55,
            profit: 61.025,
            perc: "1.4",
          },
        ];
        target.innerHTML = `<table class="table"><thead><tr><th>Category</th><th>Cost Price</th><th>Selling Price</th><th>Profit</th><th style="width:160px;">Profit %</th></tr></thead><tbody>${rows
          .map(
            (r) =>
              `<tr><td>${r.cat}</td><td>${r.cost}</td><td>${r.sell}</td><td>${r.profit}</td><td><div class='progress-container'><div class='progress-fill' style='width:${r.perc}%'></div></div><span style='font-size:0.7rem; margin-left:4px;'>${r.perc}%</span></td></tr>`
          )
          .join("")}</tbody></table>`;
        // append totals summary
        const totalCost = rows.reduce((s, r) => s + r.cost, 0).toFixed(2);
        const totalSell = rows.reduce((s, r) => s + r.sell, 0).toFixed(2);
        const totalProfit = rows.reduce((s, r) => s + r.profit, 0).toFixed(2);
        target.innerHTML +=
          `<div style="margin-top:0.5rem; background:var(--success); color:#fff; padding:0.5rem 1rem; border-radius:8px; display:flex; gap:1.5rem; flex-wrap:wrap; font-weight:700;">` +
          `<span>Total Cost : ${totalCost}</span>` +
          `<span>Total Revenue : ${totalSell}</span>` +
          `<span>Total Profit : ${totalProfit}</span>` +
          `</div>`;
      }
      function renderExpensesTab() {
        const target = document.getElementById("rep-tab-2");
        const rows = [
          { name: "packaging", amount: 304, perc: "19.2" },
          { name: "mazen", amount: 300, perc: "19.0" },
          { name: "abd", amount: 215, perc: "13.6" },
          { name: "zet", amount: 202, perc: "12.8" },
          { name: "ghrad", amount: 180.72, perc: "11.4" },
          { name: "mhmed jomae", amount: 150.5, perc: "9.5" },
          { name: "jihad", amount: 90, perc: "5.7" },
          { name: "fatima", amount: 62.5, perc: "4.0" },
          { name: "hamza", amount: 45, perc: "2.8" },
          { name: "bhar w asal", amount: 25, perc: "1.6" },
        ];
        target.innerHTML = `<table class="table"><thead><tr><th>Name</th><th>Amount</th><th style='width:140px;'>%</th></tr></thead><tbody>${rows
          .map(
            (r) =>
              `<tr><td>${r.name}</td><td>${r.amount} USD</td><td><div class='progress-container'><div class='progress-fill' style='width:${r.perc}%'></div></div><span style='font-size:0.7rem; margin-left:4px;'>${r.perc}%</span></td></tr>`
          )
          .join("")}</tbody></table>`;
        // append totals summary
        const totalAmount = rows.reduce((s, r) => s + r.amount, 0).toFixed(2);
        const totalPerc = rows
          .reduce((s, r) => s + parseFloat(r.perc), 0)
          .toFixed(1);
        target.innerHTML +=
          `<div style="margin-top:0.5rem; background:var(--warning); color:#fff; padding:0.5rem 1rem; border-radius:8px; display:flex; gap:1.5rem; flex-wrap:wrap; font-weight:700;">` +
          `<span>Total Amount : ${totalAmount} USD</span>` +
          `<span>Total % : ${totalPerc}%</span>` +
          `</div>`;
      }
      function renderReportCharts() {
        const target = document.getElementById("rep-tab-3");
        target.innerHTML =
          '<div style="flex:1; min-width:300px; max-width:400px; height:300px;"><canvas id="rep-pie"></canvas></div>' +
          '<div style="flex:1; min-width:240px;">' +
          '<div class="stat-row"><span class="stat-label"><span class="stat-dot dot-revenue"></span>Total Revenue:</span><span class="stat-value"><span class="usd">$0.00</span> | <span class="lbp">0 LBP</span></span></div>' +
          '<div class="stat-row"><span class="stat-label"><span class="stat-dot dot-cost"></span>Total Cost:</span><span class="stat-value"><span class="usd">$0.00</span> | <span class="lbp">0 LBP</span></span></div>' +
          '<div class="stat-row"><span class="stat-label"><span class="stat-dot dot-profit"></span>Total Profit:</span><span class="stat-value"><span class="usd">$0.00</span> | <span class="lbp">0 LBP</span></span></div>' +
          '<div class="stat-row"><span class="stat-label"><span class="stat-dot dot-exp"></span>Total Expenses:</span><span class="stat-value"><span class="usd">$0.00</span> | <span class="lbp">0 LBP</span></span></div>' +
          "</div>";
        if (window.Chart) {
          const ctx = document.getElementById("rep-pie").getContext("2d");
          if (window.repPie) repPie.destroy();
          window.repPie = new Chart(ctx, {
            type: "pie",
            data: {
              labels: ["Total Cost", "Total Profit", "Total Expenses"],
              datasets: [
                {
                  data: [0, 0, 0],
                  backgroundColor: ["#3b82f6", "#84cc16", "#ef4444"],
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: true,
              plugins: {
                legend: {
                  position: "bottom",
                  labels: {
                    padding: 15,
                    font: { size: 12 },
                  },
                },
              },
            },
          });
        }
      }
      // Period selector logic
      function openReportPeriod(type) {
        if (type === "daily") openModal("period-daily-modal");
        else if (type === "monthly") openModal("period-monthly-modal");
        else openModal("period-yearly-modal");
        document
          .getElementById("rep-daily-btn")
          .classList.toggle("btn-primary", type === "daily");
        document
          .getElementById("rep-monthly-btn")
          .classList.toggle("btn-primary", type === "monthly");
        document
          .getElementById("rep-yearly-btn")
          .classList.toggle("btn-primary", type === "yearly");
      }
      function setReportDate(dateStr) {
        const label = document.getElementById("report-period-label");
        label.textContent = `daily - ${dateStr}`;
        closeModal("period-daily-modal");
      }
      function setReportMonth(mIdx) {
        const months = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];
        document.getElementById(
          "report-period-label"
        ).textContent = `monthly - ${months[mIdx]} 2025`;
        closeModal("period-monthly-modal");
      }
      function setReportYear(y) {
        document.getElementById(
          "report-period-label"
        ).textContent = `yearly - ${y}`;
        closeModal("period-yearly-modal");
      }
      // populate year list
      (function () {
        // populate years
        const yearBody = document.getElementById("year-list");
        if (yearBody) {
          yearBody.innerHTML = Array.from({ length: 6 }, (_, i) => 2025 - i)
            .map(function (y) {
              return (
                '<div onclick="setReportYear(' +
                y +
                ')" style="padding:0.6rem 1rem; cursor:pointer;">' +
                y +
                "</div>"
              );
            })
            .join("");
        }
        // populate months
        const monthGrid = document.getElementById("month-grid");
        if (monthGrid) {
          const months = [
            "Jan",
            "Feb",
            "Mar",
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
            "Oct",
            "Nov",
            "Dec",
          ];
          monthGrid.innerHTML = months
            .map(function (m, i) {
              return (
                '<button class="btn btn-secondary" onclick="setReportMonth(' +
                i +
                ')">' +
                m +
                "</button>"
              );
            })
            .join("");
        }
      })();
      // when page shown
      if (typeof showPage === "function") {
        /* noop */
      }
      // ---------- END REPORT PAGE LOGIC ----------

      // Initialize Dashboard Charts
      function initializeDashboardCharts() {
        console.log("initializeDashboardCharts called");
        console.log("Chart.js loaded:", typeof Chart !== "undefined");

        if (typeof Chart === "undefined") {
          console.error("Chart.js is not loaded!");
          // Show error message in chart containers
          const chartContainers = document.querySelectorAll(
            'canvas[id$="Chart"]'
          );
          chartContainers.forEach((canvas) => {
            const parent = canvas.parentElement;
            parent.innerHTML =
              '<div style="text-align:center;padding:2rem;color:#ef4444;"><i class="fas fa-exclamation-triangle" style="font-size:2rem;margin-bottom:1rem;display:block;"></i>Failed to load Chart.js. Please check your internet connection.</div>';
          });
          return;
        }

        console.log("Looking for chart canvases...");

        // Top 10 Selling Products Chart
        const topProductsCtx = document.getElementById("topProductsChart");
        console.log("topProductsChart canvas:", topProductsCtx);
        if (topProductsCtx) {
          console.log("Creating Top Products chart...");
          try {
            const chart = new Chart(topProductsCtx.getContext("2d"), {
              type: "doughnut",
              data: {
                labels: [
                  "Product 1",
                  "Product 2",
                  "Product 3",
                  "Product 4",
                  "Product 5",
                  "Others",
                ],
                datasets: [
                  {
                    data: [25, 20, 15, 12, 10, 18],
                    backgroundColor: [
                      "#3b82f6",
                      "#ef4444",
                      "#10b981",
                      "#f59e0b",
                      "#8b5cf6",
                      "#6b7280",
                    ],
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    position: "right",
                    labels: {
                      padding: 10,
                      font: { size: 11 },
                    },
                  },
                },
              },
            });
            console.log("Top Products chart created successfully!");
          } catch (error) {
            console.error("Error creating Top Products chart:", error);
          }
        } else {
          console.warn("topProductsChart canvas not found in DOM");
        }

        // Expenses Chart
        const expensesCtx = document.getElementById("expensesChart");
        if (expensesCtx) {
          new Chart(expensesCtx.getContext("2d"), {
            type: "pie",
            data: {
              labels: [
                "Rent",
                "Salaries",
                "Utilities",
                "Supplies",
                "Marketing",
                "Other",
              ],
              datasets: [
                {
                  data: [500, 600, 150, 200, 100, 31.39],
                  backgroundColor: [
                    "#ef4444",
                    "#f59e0b",
                    "#10b981",
                    "#3b82f6",
                    "#8b5cf6",
                    "#6b7280",
                  ],
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "right",
                  labels: {
                    padding: 10,
                    font: { size: 11 },
                  },
                },
              },
            },
          });
        }

        // Sales by Users Chart
        const salesByUsersCtx = document.getElementById("salesByUsersChart");
        if (salesByUsersCtx) {
          new Chart(salesByUsersCtx.getContext("2d"), {
            type: "bar",
            data: {
              labels: ["John", "Sarah", "Mike", "Lisa", "Tom"],
              datasets: [
                {
                  label: "Sales (USD)",
                  data: [2150, 1890, 1456, 1255, 600],
                  backgroundColor: "#3b82f6",
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function (value) {
                      return "$" + value;
                    },
                  },
                },
              },
            },
          });
        }

        // Monthly Sales Chart
        const monthlySalesCtx = document.getElementById("monthlySalesChart");
        if (monthlySalesCtx) {
          const days = Array.from({ length: 30 }, (_, i) => i + 1);
          const salesData = days.map(
            () => Math.floor(Math.random() * 500) + 100
          );

          new Chart(monthlySalesCtx.getContext("2d"), {
            type: "line",
            data: {
              labels: days,
              datasets: [
                {
                  label: "Daily Sales",
                  data: salesData,
                  borderColor: "#3b82f6",
                  backgroundColor: "rgba(59, 130, 246, 0.1)",
                  tension: 0.3,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function (value) {
                      return "$" + value;
                    },
                  },
                },
              },
            },
          });
        }

        // Hourly Customers Chart
        const hourlyCustomersCtx = document.getElementById(
          "hourlyCustomersChart"
        );
        if (hourlyCustomersCtx) {
          const hours = Array.from({ length: 24 }, (_, i) => i + ":00");
          const customerData = hours.map((_, i) => {
            // Simulate peak hours
            if (i >= 11 && i <= 14) return Math.floor(Math.random() * 30) + 20;
            if (i >= 17 && i <= 20) return Math.floor(Math.random() * 25) + 15;
            if (i < 9 || i > 21) return Math.floor(Math.random() * 5);
            return Math.floor(Math.random() * 15) + 5;
          });

          new Chart(hourlyCustomersCtx.getContext("2d"), {
            type: "area",
            data: {
              labels: hours,
              datasets: [
                {
                  label: "Customers",
                  data: customerData,
                  borderColor: "#10b981",
                  backgroundColor: "rgba(16, 185, 129, 0.2)",
                  fill: true,
                  tension: 0.3,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
            },
          });
        }

        // Top Customers Chart
        const topCustomersCtx = document.getElementById("topCustomersChart");
        if (topCustomersCtx) {
          new Chart(topCustomersCtx.getContext("2d"), {
            type: "bar",
            data: {
              labels: [
                "Customer 1",
                "Customer 2",
                "Customer 3",
                "Customer 4",
                "Customer 5",
                "Customer 6",
                "Customer 7",
                "Customer 8",
                "Customer 9",
                "Customer 10",
              ],
              datasets: [
                {
                  label: "Total Spent (USD)",
                  data: [850, 720, 650, 580, 520, 480, 420, 380, 350, 320],
                  backgroundColor: "#8b5cf6",
                },
              ],
            },
            options: {
              indexAxis: "y",
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                x: {
                  beginAtZero: true,
                  ticks: {
                    callback: function (value) {
                      return "$" + value;
                    },
                  },
                },
              },
            },
          });
        }
      }

      // Make initializeDashboardCharts globally available
      window.initializeDashboardCharts = initializeDashboardCharts;

      // Also make it available as a simple function
      window.initDashboardCharts = function () {
        console.log("Direct chart initialization called");
        if (typeof Chart === "undefined") {
          alert("Chart.js is not loaded!");
          return;
        }

        // Create charts directly without checking
        try {
          // Top Products
          const ctx1 = document.getElementById("topProductsChart");
          if (ctx1) {
            new Chart(ctx1.getContext("2d"), {
              type: "doughnut",
              data: {
                labels: [
                  "Coffee",
                  "Sandwiches",
                  "Pastries",
                  "Beverages",
                  "Snacks",
                ],
                datasets: [
                  {
                    data: [30, 25, 20, 15, 10],
                    backgroundColor: [
                      "#3b82f6",
                      "#ef4444",
                      "#10b981",
                      "#f59e0b",
                      "#8b5cf6",
                    ],
                  },
                ],
              },
              options: { responsive: true, maintainAspectRatio: false },
            });
          }

          // Expenses
          const ctx2 = document.getElementById("expensesChart");
          if (ctx2) {
            new Chart(ctx2.getContext("2d"), {
              type: "pie",
              data: {
                labels: ["Rent", "Salaries", "Utilities", "Supplies", "Other"],
                datasets: [
                  {
                    data: [500, 600, 150, 200, 131.39],
                    backgroundColor: [
                      "#ef4444",
                      "#f59e0b",
                      "#10b981",
                      "#3b82f6",
                      "#6b7280",
                    ],
                  },
                ],
              },
              options: { responsive: true, maintainAspectRatio: false },
            });
          }

          // Sales by Users
          const ctx3 = document.getElementById("salesByUsersChart");
          if (ctx3) {
            new Chart(ctx3.getContext("2d"), {
              type: "bar",
              data: {
                labels: ["John", "Sarah", "Mike", "Lisa", "Tom"],
                datasets: [
                  {
                    label: "Sales (USD)",
                    data: [2150, 1890, 1456, 1255, 600],
                    backgroundColor: "#3b82f6",
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true } },
              },
            });
          }

          // Monthly Sales
          const ctx4 = document.getElementById("monthlySalesChart");
          if (ctx4) {
            const days = Array.from({ length: 30 }, (_, i) => i + 1);
            const salesData = days.map(
              () => Math.floor(Math.random() * 500) + 100
            );
            new Chart(ctx4.getContext("2d"), {
              type: "line",
              data: {
                labels: days,
                datasets: [
                  {
                    label: "Daily Sales",
                    data: salesData,
                    borderColor: "#3b82f6",
                    backgroundColor: "rgba(59, 130, 246, 0.1)",
                    tension: 0.3,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true } },
              },
            });
          }

          // Hourly Customers
          const ctx5 = document.getElementById("hourlyCustomersChart");
          if (ctx5) {
            const hours = Array.from({ length: 12 }, (_, i) => i + 9 + ":00");
            const customerData = hours.map(
              () => Math.floor(Math.random() * 30) + 5
            );
            new Chart(ctx5.getContext("2d"), {
              type: "line",
              data: {
                labels: hours,
                datasets: [
                  {
                    label: "Customers",
                    data: customerData,
                    borderColor: "#10b981",
                    backgroundColor: "rgba(16, 185, 129, 0.2)",
                    fill: true,
                    tension: 0.3,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true } },
              },
            });
          }

          // Top Customers
          const ctx6 = document.getElementById("topCustomersChart");
          if (ctx6) {
            new Chart(ctx6.getContext("2d"), {
              type: "bar",
              data: {
                labels: [
                  "Customer 1",
                  "Customer 2",
                  "Customer 3",
                  "Customer 4",
                  "Customer 5",
                ],
                datasets: [
                  {
                    label: "Total Spent (USD)",
                    data: [850, 720, 650, 580, 520],
                    backgroundColor: "#8b5cf6",
                  },
                ],
              },
              options: {
                indexAxis: "y",
                responsive: true,
                maintainAspectRatio: false,
                scales: { x: { beginAtZero: true } },
              },
            });
          }

          console.log("All charts initialized!");
        } catch (error) {
          console.error("Error creating charts:", error);
          alert("Error: " + error.message);
        }
      };

      /* ---------- Product Quick Action (Long Press) ---------- */
      let longPressTimer;
      let selectedProductCard = null;

      function attachProductCardLongPress() {
        const cards = document.querySelectorAll(".product-card");
        cards.forEach((card) => {
          card.removeEventListener("mousedown", startProductLongPress);
          card.removeEventListener("touchstart", startProductLongPress);
          card.removeEventListener("mouseup", cancelProductLongPress);
          card.removeEventListener("mouseleave", cancelProductLongPress);
          card.removeEventListener("touchend", cancelProductLongPress);

          card.addEventListener("mousedown", startProductLongPress);
          card.addEventListener("touchstart", startProductLongPress);
          card.addEventListener("mouseup", cancelProductLongPress);
          card.addEventListener("mouseleave", cancelProductLongPress);
          card.addEventListener("touchend", cancelProductLongPress);
        });
      }

      function startProductLongPress(e) {
        e.preventDefault();
        selectedProductCard = this;
        longPressTimer = setTimeout(() => {
          openModal("product-action-modal");
        }, 600);
      }

      function cancelProductLongPress() {
        clearTimeout(longPressTimer);
      }

      function editSelectedProduct() {
        if (!selectedProductCard) return;
        alert(
          "Edit product: " +
            (selectedProductCard.querySelector(".product-name")?.textContent ||
              "")
        );
        closeModal("product-action-modal");
      }

      function deleteSelectedProduct() {
        if (!selectedProductCard) return;
        const productName =
          selectedProductCard.querySelector(".product-name")?.textContent || "";
        if (confirm("Are you sure you want to delete " + productName + "?")) {
          selectedProductCard.remove();
        }
        closeModal("product-action-modal");
      }
      /* ---------- End Product Quick Action ---------- */

      /* ----- Per-item Discount Helper ----- */
      function setSelectedItemDiscount(pct){
        if(selectedCartIndex!==null && cart[selectedCartIndex]){
          cart[selectedCartIndex].discount = pct;
          updateCartDisplay();
        }
      }

      /* override slider/input handlers */
      function updateDiscountFromSlider(val){
        const input=document.querySelector('.discount-input');
        if(input) input.value=val;
        setSelectedItemDiscount(parseFloat(val)||0);
      }
      function changeDiscount(delta){
        const input=document.querySelector('.discount-input');
        if(!input) return;
        let val=parseInt(input.value||0,10);
        val=isNaN(val)?0:val+delta;
        val=Math.max(0,Math.min(100,val));
        input.value=val;
        const slider=document.querySelector('.discount-slider');
        if(slider) slider.value=val;
        setSelectedItemDiscount(val);
      }

      // Payment modal helpers
      let payCurrency='usd';
      let payInput='';
      function openPaymentModal(){
        payCurrency='usd';
        payInput='';
        document.querySelectorAll('#pay-currency-toggle .toggle-btn').forEach((b,i)=>b.classList.toggle('active',i===0));
        updatePaymentLabels();
        openModal('payment-modal');
      }
      function switchPayCurrency(btn,curr){
        payCurrency=curr;
        btn.parentElement.querySelectorAll('.toggle-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        updatePaymentLabels();
      }
      function payKeypadAppend(val){
        if(val==='000') payInput+='000';
        else if(val==='00') payInput+=payInput===''?'0':'00';
        else payInput+=String(val);
        updatePaymentLabels();
      }
      function resetPaymentInput(){payInput='';updatePaymentLabels();}
      function calculateCartTotals(){
        let subtotal=0;
        cart.forEach(it=>{subtotal+=it.price*it.quantity*(1-(it.discount||0)/100);});
        return {usd:subtotal,lbp:subtotal*90000};
      }
      function updatePaymentLabels(){
        const totals=calculateCartTotals();
        const received=parseFloat(payInput||0);
        const receivedUsd=payCurrency==='usd'?received:received/90000;
        const receivedLbp=payCurrency==='lbp'?received:received*90000;
        const changeUsd=Math.max(0,receivedUsd-totals.usd);
        const changeLbp=Math.max(0,receivedLbp-totals.lbp);
        document.getElementById('pay-total-label').textContent=`Total: ${totals.usd.toFixed(2)} USD / ${totals.lbp.toLocaleString()} LBP`;
        document.getElementById('pay-received-label').textContent=`${(payCurrency==='usd'?receivedUsd:receivedLbp).toFixed(2)} ${payCurrency.toUpperCase()}`;
        document.getElementById('pay-return-label').textContent=`${changeUsd.toFixed(2)} USD / ${changeLbp.toLocaleString()} LBP`;
      }
      function finalizePayment(){
        showToast('Receipt added successfully','success');
        closeModal('payment-modal');
        clearCart();
      }
    </script>
  </body>
</html>
